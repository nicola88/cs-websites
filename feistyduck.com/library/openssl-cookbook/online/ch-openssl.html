<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>OpenSSL Cookbook: Chapter 1. OpenSSL</title><link type="text/css" rel="stylesheet" href="styles-generic-fd.css"></link><link type="text/css" rel="stylesheet" href="styles-online-fd.css"></link><link type="text/css" rel="stylesheet" href="styles-book.css"></link><meta content="Feisty Duck Digital Delivery Service" name="generator"></meta><link rel="home" href="index.html" title="OpenSSL Cookbook"/><link rel="up" href="index.html" title="OpenSSL Cookbook"/><link rel="prev" href="preface.html" title="OpenSSL Cookbook: Preface"/><link rel="next" href="ch-testing-with-openssl.html" title="OpenSSL Cookbook: Chapter 2. Testing with OpenSSL"/><meta content="text/html;charset=utf-8" http-equiv="Content-Type"></meta><script src="jquery.min.js"></script><script><!--
		$(document).ready(function() {
			setTimeout(function() {
				showad();
			}, 20000);
			$(".closead").click(function(e) {
				e.preventDefault;
				hidead();
			});
			function showad() {
				var w = $(".advert").outerWidth();
				$(".advert").css("right", -w);
				$(".advert").show();
				$(".advert").animate({ right: 0 }, "slow", "swing");
			}
			function hidead() {
				var w = $(".advert").outerWidth();
				$(".advert").animate({ right: -w }, "slow", "swing");
			}
		});
		--></script><!--FDMARKER:HEAD--><script type='text/javascript' src='../../../includes/jquery.min.js'></script>
<script>
jQuery.post('/store/recordEvent', { sku : 'OPENSSLCKBK-D', action: 'read' });
</script>
</head><body><div id="xheader"><table style="border: 0" border="0" cellspacing="0" cellpadding="0"><tr><td><div id="xheader_cover"><a href="https://www.feistyduck.com/library/openssl%2dcookbook/"><img style="border: 1px solid grey" height="32" width="26" src="book-icon.png"/></a></div><div id="xheader_title"><a href="https://www.feistyduck.com/library/openssl%2dcookbook/">OpenSSL Cookbook</a></div><div id="xheader_crumbs">&gt; OpenSSL Cookbook: Chapter 1. OpenSSL</div></td><td width="20" align="right"><a href="https://www.feistyduck.com/library/"><img style="margin-top: 4px; margin-right: 3px;" height="16" width="16" src="fd-favicon.png"/></a></td></tr></table></div><br clear="all"></br><script src="shortcut.js"><!--dummy--></script><script><!--

function scrollback() {  
  window.scrollBy(0, -60);  
}

window.onload = scrollback;
window.onhashchange = scrollback;

function navigate(direction) {
	var links = document.getElementsByTagName("link");
	
	for (var i = 0; i < links.length; i++) {		
		if (links[i].getAttribute("rel") == direction) {			
			document.location = links[i].getAttribute("href");
		}
	}
}

shortcut.add("Ctrl+Home",function() {
	navigate("home");
});

shortcut.add("Ctrl+Up",function() {
	navigate("up");
});

shortcut.add("Ctrl+Left",function() {
	navigate("prev");
});

shortcut.add("Ctrl+Right",function() {
	navigate("next");
});

--></script><div style="top: 65px" class="xnav-icon"><a href="javascript:navigate('home')"><img alt="Contents" height="23" width="23" src="icon-toc.png"/></a></div><div style="top: 95px" class="xnav-icon"><a href="javascript:navigate('prev')"><img alt="Previous" height="23" width="23" src="icon-left.png"/></a></div><div style="top: 125px" class="xnav-icon"><a href="javascript:navigate('next')"><img alt="Next" height="23" width="23" src="icon-right.png"/></a></div><style>
.advert {
	font-family: Arial, sans-serif;
	font-size: 0.85em;
	width: 200px;
	position: fixed;
	right: 0;
	top: 58px;
	background: #fff;
	border: 1px solid #b8b8ba;
	border-right: 0;
	padding: 20px;
	text-align: left;
	z-index: 1000;
	display: none;
}
.advert h3, .advert h4, .advert p {
	margin-top: 0;
	margin-bottom: 10px;
	text-align: left;
}
.advert h4 {
	font-size: 1.2em;
	font-weight: normal;
}
a.closead {
	position: absolute;
	top: 10px;
	right: 10px;
	font-size: 22px;
	text-decoration: none;
	color: #666;
}
.advert *:last-child {
	margin-bottom: 0;
}
a.button {
	display: block;
	font-weight: bold;
	padding: 8px 10px;
	border: 1px solid  #b8b8ba;
	text-align: center;
	text-decoration: none;
	color: #000;
}
a.button:hover {
	background: #e2e2e2;
}
</style><div class="advert"><a href="ch-openssl.html#" class="closead">×</a><a href="https://www.feistyduck.com/books/bulletproof-ssl-and-tls/"><img alt="" style="width:180px;height:auto;margin-bottom:10px;border:1px solid #b8b8ba;" src="../../../images/bulletproof-cover.png"/></a><h3>If you like this, you will love Bulletproof SSL and TLS</h3><script>
		var quote = [
			"<p><em>The most comprehensive book about deploying TLS in the real world!</em> - Nasko Oskov, Chrome Security developer and former SChannel developer</p>",
			"<p><em>Meticulously researched.</em> - Eric Lawrence, Fiddler author and former Internet Explorer Program Manager</p>",
			"<p><em>The most to the point and up to date book about SSL/TLS I've read.</em> - Jakob Schlyter, IT security advisor and DANE co-author</p>",
		];
		document.write(quote[Math.floor(Math.random()*quote.length)]);
	</script><h4>Use code <strong>COOKBOOK5</strong> at checkout for <strong>£5 off</strong>.</h4><a href="https://www.feistyduck.com/books/bulletproof-ssl-and-tls/" class="button">Buy Now</a></div><div class="chapter" title="OpenSSL Cookbook: Chapter 1. OpenSSL"><div class="titlepage"><div><h1><span class="partLabel">1</span> OpenSSL</h1></div></div><a class="indexterm" id="i-openssl"/><p id="PN100BD">OpenSSL is an open source project that consists of a cryptographic library and an SSL/TLS
        toolkit. From the project’s web site:</p><div class="blockquote"><blockquote class="blockquote"><p id="PN100C0">The OpenSSL Project is a collaborative effort to develop a robust, commercial-grade,
            full-featured, and Open Source toolkit implementing the Secure Sockets Layer (SSL) and
            Transport Layer Security (TLS) protocols as well as a full-strength general purpose
            cryptography library. The project is managed by a worldwide community of volunteers that
            use the Internet to communicate, plan, and develop the OpenSSL toolkit and its related
            documentation.</p></blockquote></div><p id="PN100C2">OpenSSL is a de facto standard in this space and comes with a long history. The code
        initially began its life in 1995 under the name SSLeay,<a href="ch-openssl.html#ftn.N100C4" id="N100C4" class="footnote">1</a> when it was developed by Eric A. Young and Tim J. Hudson. The OpenSSL project
        was born in the last days of 1998, when Eric and Tim stopped their work on SSLeay to work on
        a commercial SSL/TLS toolkit called BSAFE SSL-C at RSA Australia.</p><p id="PN100C8">Today, OpenSSL is ubiquitous on the server side and in many client tools. The command-line
        tools are also the most common choice for key and certificate management as well as testing.
        Interestingly, browsers have historically used other libraries, although that’s now changing
        because Google is migrating Chrome to its own OpenSSL fork called
            <em class="firstterm">BoringSSL</em>.<a href="ch-openssl.html#ftn.N100CD" id="N100CD" class="footnote">2</a></p><p id="PN100D3">OpenSSL is dual-licensed under OpenSSL and SSLeay licenses. Both are BSD-like, with an
        advertising clause. The license has been a source of contention for a very long time,
        because neither of the licenses is considered compatible with the GPL family of licenses.
        For that reason, you will often find that GPL-licensed programs favor GnuTLS.</p><div class="section" title="Getting Started"><div class="titlepage"><div><div><h2 class="title"><a id="getting-started"/><a class="heading-link" href="ch-openssl.html#getting-started">Getting Started</a></h2></div></div></div><p id="PN100D9">If you’re using one of the Unix platforms, getting started with OpenSSL is easy;
            you’re virtually guaranteed to already have it on your system. The only problem that you
            might face is that you might not have the latest version. In this section, I assume that
            you’re using a Unix platform, because that’s the natural environment for OpenSSL.</p><p id="PN100DB">Windows users tend to download binaries, which might complicate the situation
            slightly. In the simplest case, if you need OpenSSL only for its command-line utilities,
            the main OpenSSL web site links to Shining Light Productions<a href="ch-openssl.html#ftn.N100DD" id="N100DD" class="footnote">3</a> for the Windows binaries. In all other situations, you need to ensure that
            you’re not mixing binaries compiled under different versions of OpenSSL. Otherwise, you
            might experience crashes that are difficult to troubleshoot. The best approach is to use
            a single bundle of programs that includes everything that you need. For example, if you
            want to run Apache on Windows, you can get your binaries from the Apache Lounge.<a href="ch-openssl.html#ftn.N100E4" id="N100E4" class="footnote">4</a></p><div class="section" title="Determine OpenSSL Version and Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="determine-version-and-configuration"/><a class="heading-link" href="ch-openssl.html#determine-version-and-configuration">Determine OpenSSL Version and Configuration</a></h3></div></div></div><p id="PN100EE">Before you do any work, you should know which OpenSSL version you’ll be
                using. For example, here’s what I get for version information with <code class="command">openssl
                    version</code> on Ubuntu 12.04 LTS, which is the system that I’ll be using
                for the examples in this chapter:</p><pre class="programlisting" id="N100F4">$ openssl version
OpenSSL 1.0.1 14 Mar 2012</pre><p id="PN100F6">At the time of this writing, a transition from OpenSSL 0.9.x to OpenSSL 1.0.x is
                in progress. The version 1.0.1 is especially significant because it is the first
                version to support TLS 1.1 and 1.2. The support for newer protocols is part of a
                global trend, so it’s likely that we’re going to experience a period during which
                interoperability issues are not uncommon.</p><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN100F9">Various operating systems often modify the OpenSSL code, usually to fix known
                    issues. However, the name of the project and the version number generally stay
                    the same, and there is no indication that the code is actually a fork of the
                    original project that will behave differently. For example, the version of
                    OpenSSL used in Ubuntu 12.04 LTS<a href="ch-openssl.html#ftn.N100FB" id="N100FB" class="footnote">5</a> is based on OpenSSL 1.0.1c. At the time of this writing, the full
                    name of the package is <code class="literal">openssl 1.0.1-4ubuntu5.16,</code> and it
                    contains patches for the many issues that came to light over time.</p></div><p id="PN10105">To get complete version information, use the <code class="literal">-a</code> switch:</p><pre class="programlisting" id="N1010A">$ openssl version -a
OpenSSL 1.0.1 14 Mar 2012
built on: Fri Jun 20 18:54:15 UTC 2014
platform: debian-amd64
options:  bn(64,64) rc4(8x,int) des(idx,cisc,16,int) blowfish(idx)
compiler: cc -fPIC -DOPENSSL_PIC -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN ↩
-DHAVE_DLFCN_H -m64 -DL_ENDIAN -DTERMIO -g -O2 -fstack-protector --param=ssp-buffer-size↩
=4 -Wformat -Wformat-security -Werror=format-security -D_FORTIFY_SOURCE=2 ↩
-Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DOPENSSL_NO_TLS1_2↩
_CLIENT -DOPENSSL_MAX_TLS1_2_CIPHER_LENGTH=50 -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 ↩
-DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256↩
_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH↩
_ASM
OPENSSLDIR: "/usr/lib/ssl"</pre><p id="PN1010C">The last line in the output (<code class="filename">/usr/lib/ssl</code>) is especially
                interesting because it will tell you where OpenSSL will look for its configuration
                and certificates. On my system, that location is essentially an alias for
                    <code class="filename">/etc/ssl</code>, where Ubuntu keeps TLS-related files:</p><pre class="programlisting" id="N10114">lrwxrwxrwx  1 root root   14 Apr 19 09:28 certs -&gt; /etc/ssl/certs
drwxr-xr-x  2 root root 4096 May 28 06:04 misc
lrwxrwxrwx  1 root root   20 May 22 17:07 openssl.cnf -&gt; /etc/ssl/openssl.cnf
lrwxrwxrwx  1 root root   16 Apr 19 09:28 private -&gt; /etc/ssl/private</pre><p id="PN10116">The <code class="filename">misc/</code> folder contains a few supplementary scripts, the
                most interesting of which are the scripts that allow you to implement a private
                    <em class="firstterm">certification authority</em> (CA).</p></div><div class="section" title="Building OpenSSL"><div class="titlepage"><div><div><h3 class="title"><a id="building-openssl"/><a class="heading-link" href="ch-openssl.html#building-openssl">Building OpenSSL</a></h3></div></div></div><p id="PN10122">In most cases, you will be using the system-supplied version of OpenSSL, but
                sometimes there are good reasons to upgrade. For example, your system might be stuck
                with OpenSSL 0.9.x, which doesn’t support newer TLS protocol versions, and even if
                the system OpenSSL is the right version, it might not have the features you need.
                For example, on Ubuntu 12.04 LTS, there’s no support for SSL 2 in the
                    <code class="command">s_client</code> command. Although not supporting this version of SSL
                by default is the right decision, you’ll need this feature if you’re routinely
                testing other servers for SSL 2 support.</p><p id="PN10127">You can start by downloading the most recent version of OpenSSL (in my case,
                1.0.1p):</p><pre class="programlisting" id="N10129">$ wget http://www.openssl.org/source/openssl-1.0.1p.tar.gz</pre><p id="PN1012B">The next step is to configure OpenSSL before compilation. In most cases, you’ll be
                leaving the system-provided version alone and installing OpenSSL in a different
                location. For example:</p><pre class="programlisting" id="N1012D">$ ./config \
--prefix=/opt/openssl \
--openssldir=/opt/openssl \
enable-ec_nistp_64_gcc_128</pre><p id="PN1012F">The <code class="literal">enable-ec_nistp_64_gcc_128</code> parameter activates optimized
                versions of certain frequently used elliptic curves. This optimization depends on a
                compiler feature that can’t be automatically detected, which is why it’s disabled by
                default.</p><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN10135">If you’re compiling a version of OpenSSL from the 1.1.x branch and above, on
                    at least some systems you’ll need to use the <code class="literal">no-shared</code>
                    parameter to produce statically-compiled command line tools. You’ll know you
                    need to use this parameter if (after the compilation) you’re trying to invoke
                    the OpenSSL binary and it’s complaining about not finding some required shared
                    libraries.</p></div><p id="PN1013A">You can then follow with:</p><pre class="programlisting" id="N1013C">$ make depend
$ make
$ sudo make install</pre><p id="PN1013E">You’ll get the following in <code class="filename">/opt/openssl</code>:</p><pre class="programlisting" id="N10143">drwxr-xr-x 2 root root  4096 Jun  3 08:49 bin
drwxr-xr-x 2 root root  4096 Jun  3 08:49 certs
drwxr-xr-x 3 root root  4096 Jun  3 08:49 include
drwxr-xr-x 4 root root  4096 Jun  3 08:49 lib
drwxr-xr-x 6 root root  4096 Jun  3 08:48 man
drwxr-xr-x 2 root root  4096 Jun  3 08:49 misc
-rw-r--r-- 1 root root 10835 Jun  3 08:49 openssl.cnf
drwxr-xr-x 2 root root  4096 Jun  3 08:49 private</pre><p id="PN10145">The <code class="filename">private/</code> folder is empty, but that’s normal; you do not
                yet have any private keys. On the other hand, you’ll probably be surprised to learn
                that the <code class="filename">certs/</code> folder is empty too. OpenSSL does not include
                any root certificates; maintaining a trust store is considered outside the scope of
                the project. Luckily, your operating system probably already comes with a trust
                store that you can use. You can also build your own with little effort, as you’ll
                see in the next section.</p><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN1014E">When compiling software, it’s important to be familiar with the default
                    configuration of your compiler. System-provided packages are usually compiled
                    using all the available hardening options, but if you compile some software
                    yourself there is no guarantee that the same options will be used.<a href="ch-openssl.html#ftn.N10150" id="N10150" class="footnote">6</a></p></div></div><div class="section" title="Examine Available Commands"><div class="titlepage"><div><div><h3 class="title"><a id="examine-available-commands"/><a class="heading-link" href="ch-openssl.html#examine-available-commands">Examine Available Commands</a></h3></div></div></div><p id="PN1015A">OpenSSL is a cryptographic toolkit that consists of many different utilities. I
                counted 46 in my version. If it were ever appropriate to use the phrase
                    <em>Swiss Army knife of cryptography</em>, this is it. Even though
                you’ll use only a handful of the utilities, you should familiarize yourself with
                everything that’s available, because you never know what you might need in the
                future.</p><p id="PN1015F">There isn’t a specific help keyword, but help text is displayed whenever you type
                something OpenSSL does not recognize:</p><pre class="programlisting" id="N10161">$ openssl help
openssl:Error: 'help' is an invalid command.

Standard commands
asn1parse         ca                ciphers           cms
crl               crl2pkcs7         dgst              dh
dhparam           dsa               dsaparam          ec
ecparam           enc               engine            errstr
gendh             gendsa            genpkey           genrsa
nseq              ocsp              passwd            pkcs12
pkcs7             pkcs8             pkey              pkeyparam
pkeyutl           prime             rand              req
rsa               rsautl            s_client          s_server
s_time            sess_id           smime             speed
spkac             srp               ts                verify
version           x509</pre><p id="PN10163">The first part of the help output lists all available utilities. To get more
                information about a particular utility, use the <code class="command">man</code> command
                followed by the name of the utility. For example, <code class="command">man ciphers</code>
                will give you detailed information on how cipher suites are configured.</p><p id="PN1016B">Help output doesn’t actually end there, but the rest is somewhat less interesting.
                In the second part, you get the list of message digest commands:</p><pre class="programlisting" id="N1016D">Message Digest commands (see the `dgst' command for more details)
md4               md5               rmd160            sha
sha1</pre><p id="PN1016F">And then, in the third part, you’ll see the list of all cipher commands:</p><pre class="programlisting" id="N10171">Cipher commands (see the `enc' command for more details)
aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb
aes-256-cbc       aes-256-ecb       base64            bf
bf-cbc            bf-cfb            bf-ecb            bf-ofb
camellia-128-cbc  camellia-128-ecb  camellia-192-cbc  camellia-192-ecb
camellia-256-cbc  camellia-256-ecb  cast              cast-cbc
cast5-cbc         cast5-cfb         cast5-ecb         cast5-ofb
des               des-cbc           des-cfb           des-ecb
des-ede           des-ede-cbc       des-ede-cfb       des-ede-ofb
des-ede3          des-ede3-cbc      des-ede3-cfb      des-ede3-ofb
des-ofb           des3              desx              rc2
rc2-40-cbc        rc2-64-cbc        rc2-cbc           rc2-cfb
rc2-ecb           rc2-ofb           rc4               rc4-40
seed              seed-cbc          seed-cfb          seed-ecb
seed-ofb          zlib</pre></div><div class="section" title="Building a Trust Store"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-building-a-trust-store"/><a class="heading-link" href="ch-openssl.html#openssl-building-a-trust-store">Building a Trust Store<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10177"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1017A"></a></a></h3></div></div></div><p id="PN1017F">OpenSSL does not come with any trusted root certificates (also known as a
                    <em class="firstterm">trust store</em>), so if you’re installing from scratch you’ll
                have to find them somewhere else. One possibility is to use the trust store built
                into your operating system. This choice is usually fine, but default trust stores
                may not always be up to date. A better choice—but one that involves more work—is to
                turn to Mozilla, which is putting a lot of effort into maintaining a robust trust
                store. For example, this is what I did for my assessment tool on SSL Labs.</p><p id="PN10184">Because it’s open source, Mozilla keeps the trust store in the source code
                repository:</p><pre class="programlisting" id="N10186">https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins↩
/certdata.txt</pre><p id="PN10188">Unfortunately, their certificate collection is in a proprietary format, which is
                not of much use to others as is. If you don’t mind getting the collection via a
                third party, the Curl project provides a regularly-updated conversion in
                    <em class="firstterm">Privacy-Enhanced Mail</em> (PEM) format, which you can use
                directly:</p><pre class="programlisting" id="N1018D">http://curl.haxx.se/docs/caextract.html</pre><p id="PN1018F">But you don’t have to write a conversion script if you’d rather download directly
                from Mozilla. Conversion scripts are available in Perl or Go. I describe both in the
                following sections.</p><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN10192">If you do end up working on your own conversion script, note that Mozilla’s
                    root certificate file actually contains two types of certificates: those that
                    are trusted and are part of the store and also those that are explicitly
                    distrusted. They use this mechanism to ban compromised intermediate CA
                    certificates (e.g., DigiNotar’s old certificates). Both conversion tools
                    described here are smart enough to exclude distrusted certificates during the
                    conversion process.</p></div><div class="section" title="Conversion Using Perl"><div class="titlepage"><div><div><h4 class="title"><a id="root-store-conversion-using-perl"/><a class="heading-link" href="ch-openssl.html#root-store-conversion-using-perl">Conversion Using Perl</a></h4></div></div></div><p id="PN10198">The Curl project makes available a Perl script written by Guenter Knauf that
                    can be used to convert Mozilla’s trust store:</p><pre class="programlisting" id="N1019A">https://raw.github.com/bagder/curl/master/lib/mk-ca-bundle.pl</pre><p id="PN1019C">After you download and run the script, it will fetch the certificate data from
                    Mozilla and convert it to the PEM format:</p><pre class="programlisting" id="N1019E">$ ./mk-ca-bundle.pl
Downloading 'certdata.txt' ...
Processing  'certdata.txt' ...
Done (156 CA certs processed, 19 untrusted skipped).</pre><p id="PN101A0">If you keep previously downloaded certificate data around, the script will use
                    it to determine what changed and process only the updates.</p></div><div class="section" title="Conversion Using Go"><div class="titlepage"><div><div><h4 class="title"><a id="root-store-conversion-using-go"/><a class="heading-link" href="ch-openssl.html#root-store-conversion-using-go">Conversion Using Go</a></h4></div></div></div><p id="PN101A6">If you prefer the Go programming language, consider Adam Langley’s conversion
                    tool, which you can get from GitHub:</p><pre class="programlisting" id="N101A8">https://github.com/agl/extract-nss-root-certs</pre><p id="PN101AA">To kick off a conversion process, first download the tool itself:</p><pre class="programlisting" id="N101AC">$ wget https://raw.github.com/agl/extract-nss-root-certs/master/convert_mozilla↩
_certdata.go</pre><p id="PN101AE">Then download Mozilla’s certificate data:</p><pre class="programlisting" id="N101B0">$ wget https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw↩
/builtins/certdata.txt --output-document certdata.txt</pre><p id="PN101B2">Finally, convert the file with the following command:</p><pre class="programlisting" id="N101B4">$ go run convert_mozilla_certdata.go &gt; ca-certificates
2012/06/04 09:52:29 Failed to parse certificate starting on line 23068: negative serial ↩
number </pre><p id="PN101B6">In my case, there was one invalid certificate that the Go X.509 library
                    couldn’t handle, but otherwise the conversion worked as expected. Go versions
                    from 1.6 onwards shouldn’t produce this warning because they can handle
                    certificates with negative serial numbers.</p></div></div></div><div class="section" title="Key and Certificate Management"><div class="titlepage"><div><div><h2 class="title"><a id="openssl-key-and-certificate-management"/><a class="heading-link" href="ch-openssl.html#openssl-key-and-certificate-management">Key and Certificate Management</a></h2></div></div></div><p id="PN101BC">Most users turn to OpenSSL because they wish to configure and run a web server that
            supports SSL. That process consists of three steps: (1) generate a strong private key, (2) create a <em class="firstterm">Certificate Signing Request</em> (CSR)
            and send it to a CA, and (3) install the
            CA-provided certificate in your web server. These steps (and a few others) are covered
            in this section.</p><div class="section" title="Key Generation"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-key-generation"/><a class="heading-link" href="ch-openssl.html#openssl-key-generation">Key Generation</a></h3></div></div></div><p id="PN101D1">The first step in preparing for the use of public encryption is to generate a
                private key. Before you begin, you must make several decisions:</p><div class="variablelist"><dl><dt><span class="term">Key algorithm</span></dt><dd><p id="PN101D8">OpenSSL supports RSA, DSA, and ECDSA keys, but not all types are
                            practical for use in all scenarios. For example, for web server keys
                            everyone uses RSA, because DSA keys are effectively limited to 1,024
                            bits (Internet Explorer doesn’t support anything stronger) and ECDSA
                            keys are yet to be widely supported by CAs. For SSH, DSA and RSA are
                            widely used, whereas ECDSA might not be supported by all clients.</p></dd><dt><span class="term">Key size</span></dt><dd><p id="PN101DE">The default key sizes might not be secure, which is why you should
                            always explicitly configure key size. For example, the default for RSA
                            keys is only 512 bits, which is simply insecure. If you used a 512-bit
                            key on your server today, an intruder could take your certificate and
                            use brute force to recover your private key, after which he or she could
                            impersonate your web site. Today, 2,048-bit RSA keys are considered
                            secure, and that’s what you should use. Aim also to use 2,048 bits for
                            DSA keys and at least 256 bits for ECDSA.</p></dd><dt><span class="term">Passphrase</span></dt><dd><p id="PN101E4">Using a passphrase with a key is optional, but strongly recommended.
                            Protected keys can be safely stored, transported, and backed up. On the
                            other hand, such keys are inconvenient, because they can’t be used
                            without their passphrases. For example, you might be asked to enter the
                            passphrase every time you wish to restart your web server. For most,
                            this is either too inconvenient or has unacceptable availability
                            implications. In addition, using protected keys in production does not
                            actually increase the security much, if at all. This is because, once
                            activated, private keys are kept unprotected in program memory; an
                            attacker who can get to the server can get the keys from there with just
                            a little more effort. Thus, passphrases should be viewed only as a
                            mechanism for protecting private keys when they are not installed on
                            production systems. In other words, it’s all right to keep passphrases
                            on production systems, next to the keys. If you need better security in
                            production, you should invest in a hardware solution.<a href="ch-openssl.html#ftn.N101E6" id="N101E6" class="footnote">7</a></p></dd></dl></div><p id="PN101EC">To generate an RSA key, use the <code class="command">genrsa</code> command:</p><pre class="programlisting" id="N101F1">$ openssl genrsa -aes128 -out fd.key 2048
Generating RSA private key, 2048 bit long modulus
....+++
...................................................................................+++
e is 65537 (0x10001)
Enter pass phrase for fd.key: ****************
Verifying - Enter pass phrase for fd.key: ****************</pre><p id="PN101F3">Here, I specified that the key be protected with AES-128. You can also use AES-192
                or AES-256 (switches <code class="literal">-aes192</code> and <code class="literal">-aes256</code>,
                respectively), but it’s best to stay away from the other algorithms (DES, 3DES, and
                SEED).</p><div class="warning" title="Warning"><h3 class="title">Warning</h3><p id="PN101FC"><a class="indexterm" id="N101FD"/>The <code class="literal">e</code> value that you see in the output refers to
                    the public exponent, which is set to 65,537 by default. This is what’s known as
                    a <em>short public exponent</em>, and it significantly improves the
                    performance of RSA verification. Using the <code class="literal">-3</code> switch, you can
                    choose 3 as your public exponent and make verification even faster. However,
                    there are some unpleasant historical weaknesses associated with the use of 3 as
                    a public exponent, which is why generally everyone recommends that you stick
                    with 65,537. The latter choice provides a safety margin that’s been proven
                    effective in the past.</p></div><p id="PN1020A">Private keys are stored in the so-called PEM format, which is just text:</p><pre class="programlisting" id="N1020C">$ cat fd.key
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,01EC21976A463CE36E9DB59FF6AF689A

vERmFJzsLeAEDqWdXX4rNwogJp+y95uTnw+bOjWRw1+O1qgGqxQXPtH3LWDUz1Ym
mkpxmIwlSidVSUuUrrUzIL+V21EJ1W9iQ71SJoPOyzX7dYX5GCAwQm9Tsb40FhV/
[21 lines removed...]
4phGTprEnEwrffRnYrt7khQwrJhNsw6TTtthMhx/UCJdpQdaLW/TuylaJMWL1JRW
i321s5me5ej6Pr4fGccNOe7lZK+563d7v5znAx+Wo1C+F7YgF+g8LOQ8emC+6AVV
-----END RSA PRIVATE KEY-----</pre><p id="PN1020E">A private key isn’t just a blob of random data, even though that’s what it looks
                like at a glance. You can see a key’s structure using the following
                    <code class="command">rsa</code> command:</p><pre class="programlisting" id="N10213">$ openssl rsa -text -in fd.key
Enter pass phrase for fd.key: ****************
Private-Key: (2048 bit)
modulus:
    00:9e:57:1c:c1:0f:45:47:22:58:1c:cf:2c:14:db:
    [...]
publicExponent: 65537 (0x10001)
privateExponent:
    1a:12:ee:41:3c:6a:84:14:3b:be:42:bf:57:8f:dc:
    [...]
prime1:
    00:c9:7e:82:e4:74:69:20:ab:80:15:99:7d:5e:49:
    [...]
prime2:
    00:c9:2c:30:95:3e:cc:a4:07:88:33:32:a5:b1:d7:
    [...]
exponent1:
    68:f4:5e:07:d3:df:42:a6:32:84:8d:bb:f0:d6:36:
    [...]
exponent2:
    5e:b8:00:b3:f4:9a:93:cc:bc:13:27:10:9e:f8:7e:
    [...]
coefficient:
    34:28:cf:72:e5:3f:52:b2:dd:44:56:84:ac:19:00:
    [...]
writing RSA key
-----BEGIN RSA PRIVATE KEY-----
[...]
-----END RSA PRIVATE KEY-----</pre><p id="PN10215">If you need to have just the public part of a key separately, you can do that with
                the following <code class="command">rsa</code> command:</p><pre class="programlisting" id="N1021A">$ openssl rsa -in fd.key -pubout -out fd-public.key
Enter pass phrase for fd.key: ****************</pre><p id="PN1021C">If you look into the newly generated file, you’ll see that the markers clearly
                indicate that the contained information is indeed public:</p><pre class="programlisting" id="N1021E">$ cat fd-public.key
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnlccwQ9FRyJYHM8sFNsY
PUHJHJzhJdwcS7kBptutf/L6OvoEAzCVHi/m0qAA4QM5BziZgnvv+FNnE3sgE5pz
iovEHJ3C959mNQmpvnedXwfcOIlbrNqdISJiP0js6mDCzYjSO1NCQoy3UpYwvwj7
0ryR1F+abARehlts/Xs/PtX3VamrljiJN6JNgFICy3ZvEhLZEKxR7oob7TnyZDrj
IHxBbqPNzeiqLCFLFPGgJPa0cH8DdovBTesvu7wr/ecsf8CYyUCdEwGkZh9DKtdU
HFa9H8tWW2mX6uwYeHCnf2HTw0E8vjtOb8oYQxlQxtL7dpFyMgrpPOoOVkZZW/P0
NQIDAQAB
-----END PUBLIC KEY-----</pre><p id="PN10220">It’s good practice to verify that the output contains what you’re expecting. For
                example, if you forget to include the <code class="literal">-pubout</code> switch on the
                command line, the output will contain your private key instead of the public
                key.</p><p id="PN10225">DSA key generation is a two-step process: DSA parameters are created in the first
                step and the key in the second. Rather than execute the steps one at a time, I tend
                to use the following two commands as one:</p><pre class="programlisting" id="N10227">$ openssl dsaparam -genkey 2048 | openssl dsa -out dsa.key -aes128
Generating DSA parameters, 2048 bit long prime
This could take some time
[...]
read DSA key
writing DSA key
Enter PEM pass phrase: ****************
Verifying - Enter PEM pass phrase: ****************</pre><p id="PN10229">This approach allows me to generate a password-protected key without leaving any
                temporary files (DSA parameters) and/or temporary keys on disk.</p><p id="PN1022B">The process is similar for ECDSA keys, except that it isn’t possible to create
                keys of arbitrary sizes. Instead, for each key you select a <em class="firstterm">named
                    curve</em>, which controls key size, but it controls other EC parameters
                as well. The following example creates a 256-bit ECDSA key using the
                    <code class="literal">secp256r1</code> named curve:</p><pre class="programlisting" id="N10233">$ openssl ecparam -genkey -name secp256r1 | openssl ec -out ec.key -aes128
using curve name prime256v1 instead of secp256r1
read EC key
writing EC key
Enter PEM pass phrase: ****************
Verifying - Enter PEM pass phrase: ****************</pre><p id="PN10235">OpenSSL supports many named curves (you can get a full list with the
                    <code class="literal">-list_curves</code> switch), but, for web server keys, you’re
                limited to only two curves that are supported by all major browsers:
                    <code class="literal">secp256r1</code> (OpenSSL uses the name
                    <code class="literal">prime256v1</code>) and <code class="literal">secp384r1</code>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN10244">If you’re using OpenSSL 1.0.2, you can save yourself time by always generating
                    your keys using the <code class="literal">genpkey</code> command, which has been improved
                    to support various key types and configuration parameters. It now represents a
                    unified interface for key generation.</p></div></div><div class="section" title="Creating Certificate Signing Requests"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-creating-csrs"/><a class="heading-link" href="ch-openssl.html#openssl-creating-csrs">Creating Certificate Signing Requests<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1024D"></a></a></h3></div></div></div><p id="PN10252">Once you have a private key, you can proceed to create a <em>Certificate
                    Signing Request</em> (CSR). This is a formal request asking a CA to sign a
                certificate, and it contains the public key of the entity requesting the certificate
                and some information about the entity. This data will all be part of the
                certificate. A CSR is always signed with the private key corresponding to the public
                key it carries.</p><p id="PN10257">CSR creation is usually an interactive process during which you’ll be providing
                the elements of the certificate distinguished name. Read the instructions given by
                the <code class="command">openssl</code> tool carefully; if you want a field to be empty, you
                must enter a single dot (<code class="literal">.</code>) on the line, rather than just hit
                Return. If you do the latter, OpenSSL will populate the corresponding CSR field with
                the default value. (This behavior doesn’t make any sense when used with the default
                OpenSSL configuration, which is what virtually everyone does. It
                    <em>does</em> make sense once you realize you can actually change
                the defaults, either by modifying the OpenSSL configuration or by providing your own
                configuration files.)</p><pre class="programlisting" id="N10262">$ openssl req -new -key fd.key -out fd.csr
Enter pass phrase for fd.key: ****************
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:GB
State or Province Name (full name) [Some-State]:.
Locality Name (eg, city) []:London
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Feisty Duck Ltd
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:www.feistyduck.com
Email Address []:webmaster@feistyduck.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:</pre><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN10265">According to Section 5.4.1 of RFC 2985,<a href="ch-openssl.html#ftn.N10267" id="N10267" class="footnote">8</a>
                    <em>challenge password</em> is an optional field that was intended
                    for use during certificate revocation as a way of identifying the original
                    entity that had requested the certificate. If entered, the password will be
                    included verbatim in the CSR and communicated to the CA. It’s rare to find a CA
                    that relies on this field; all instructions I’ve seen recommend leaving it
                    alone. Having a challenge password does not increase the security of the CSR in
                    any way. Further, this field should not be confused with the key passphrase,
                    which is a separate feature.</p></div><p id="PN10271">After a CSR is generated, use it to sign your own certificate and/or send it to a
                public CA and ask it to sign the certificate. Both approaches are described in the
                following sections. But before you do that, it’s a good idea to double-check that
                the CSR is correct. Here’s how:</p><pre class="programlisting" id="N10273">$ openssl req -text -in fd.csr -noout
Certificate Request:
    Data:
        Version: 0 (0x0)
        Subject: C=GB, L=London, O=Feisty Duck Ltd, CN=www.feistyduck.com↩
/emailAddress=webmaster@feistyduck.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b7:fc:ca:1c:a6:c8:56:bb:a3:26:d1:df:e4:e3:
                    [16 more lines...]
                    d1:57
                Exponent: 65537 (0x10001)
        Attributes:
            a0:00
    Signature Algorithm: sha1WithRSAEncryption
         a7:43:56:b2:cf:ed:c7:24:3e:36:0f:6b:88:e9:49:03:a6:91:
         [13 more lines...]
         47:8b:e3:28</pre></div><div class="section" title="Creating CSRs from Existing Certificates"><div class="titlepage"><div><div><h3 class="title"><a id="creating-csrs-from-existing-certificates"/><a class="heading-link" href="ch-openssl.html#creating-csrs-from-existing-certificates">Creating CSRs from Existing Certificates</a></h3></div></div></div><p id="PN10279">You can save yourself some typing if you’re renewing a certificate and don’t want
                to make any changes to the information presented in it. With the following command,
                you can create a brand-new CSR from an existing certificate:</p><pre class="programlisting" id="N1027B">$ openssl x509 -x509toreq -in fd.crt -out fd.csr -signkey fd.key</pre><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN1027E">Unless you’re using some form of public key pinning and wish to continue using
                    the existing key, it’s best practice to generate a new key every time you apply
                    for a new certificate. Key generation is quick and inexpensive and reduces your
                    exposure.</p></div></div><div class="section" title="Unattended CSR Generation"><div class="titlepage"><div><div><h3 class="title"><a id="unattended-csr-generation"/><a class="heading-link" href="ch-openssl.html#unattended-csr-generation">Unattended CSR Generation</a></h3></div></div></div><p id="PN10284">CSR generation doesn’t have to be interactive. Using a custom OpenSSL
                configuration file, you can both automate the process (as explained in this section)
                and do certain things that are not possible interactively (as discussed in
                subsequent sections).</p><p id="PN10286">For example, let’s say that we want to automate the generation of a CSR for
                    <code class="literal">www.feistyduck.com</code>. We would start by creating a file
                    <code class="filename">fd.cnf</code> with the following contents:</p><pre class="programlisting" id="N1028E">[req]
prompt = no
distinguished_name = dn
req_extensions = ext
input_password = <em class="replaceable"><code>PASSPHRASE</code></em>

[dn]
CN = www.feistyduck.com
emailAddress = webmaster@feistyduck.com
O = Feisty Duck Ltd
L = London
C = GB

[ext]
subjectAltName = DNS:www.feistyduck.com,DNS:feistyduck.com</pre><p id="PN10293">Now you can create the CSR directly from the command line:</p><pre class="programlisting" id="N10295">$ openssl req -new -config fd.cnf -key fd.key -out fd.csr</pre></div><div class="section" title="Signing Your Own Certificates"><div class="titlepage"><div><div><h3 class="title"><a id="signing-your-own-certificates"/><a class="heading-link" href="ch-openssl.html#signing-your-own-certificates">Signing Your Own Certificates</a></h3></div></div></div><p id="PN1029B">If you’re installing a TLS server for your own use, you probably don’t want to go
                to a CA for a publicly trusted certificate. It’s much easier just to use a
                self-signed certificate. If you’re a Firefox user, on your first visit to the web
                site you can create a certificate exception, after which the site will be as secure
                as if it were protected with a publicly trusted certificate.</p><p id="PN1029D">If you already have a CSR, create a certificate using the following
                command:</p><pre class="programlisting" id="N1029F">$ openssl x509 -req -days 365 -in fd.csr -signkey fd.key -out fd.crt
Signature ok
subject=/CN=www.feistyduck.com/emailAddress=webmaster@feistyduck.com/O=Feisty Duck Ltd↩
/L=London/C=GB
Getting Private key
Enter pass phrase for fd.key: ****************</pre><p id="PN102A1">You don’t actually have to create a CSR in a separate step. The following command
                creates a self-signed certificate starting with a key alone:</p><pre class="programlisting" id="N102A3">$ openssl req -new -x509 -days 365 -key fd.key -out fd.crt</pre><p id="PN102A5">If you don’t wish to be asked any questions, use the <code class="literal">-subj</code>
                switch to provide the certificate subject information on the command line:</p><pre class="programlisting" id="N102AA">$ openssl req -new -x509 -days 365 -key fd.key -out fd.crt \
 -subj "/C=GB/L=London/O=Feisty Duck Ltd/CN=www.feistyduck.com"</pre></div><div class="section" title="Creating Certificates Valid for Multiple Hostnames"><div class="titlepage"><div><div><h3 class="title"><a id="creating-certificates-valid-for-multiple-hostnames"/><a class="heading-link" href="ch-openssl.html#creating-certificates-valid-for-multiple-hostnames">Creating Certificates Valid for Multiple Hostnames</a></h3></div></div></div><p id="PN102B0">By default, certificates produced by OpenSSL have only one common name and are
                valid for only one hostname. Because of this, even if you have related web sites,
                you are forced to use a separate certificate for each site. In this situation, using
                a single <em>multidomain</em> certificate makes much more sense.
                Further, even when you’re running a single web site, you need to ensure that the
                certificate is valid for all possible paths that end users can take to reach it. In
                practice, this means using at least two names, one with the <code class="literal">www</code>
                prefix and one without (e.g., <code class="literal">www.feistyduck.com</code> and
                    <code class="literal">feistyduck.com</code>).</p><p id="PN102BE">There are two mechanisms for supporting multiple hostnames in a certificate. The
                first is to list all desired hostnames using an X.509 extension called
                    <em class="firstterm">Subject Alternative Name</em> (SAN). The second is to use
                wildcards. You can also use a combination of the two approaches when it’s more
                convenient. In practice, for most sites, you can specify a bare domain name and a
                wildcard to cover all the subdomains (e.g., <code class="literal">feistyduck.com</code> and
                    <code class="literal">*.feistyduck.com</code>).</p><div class="warning" title="Warning"><h3 class="title">Warning</h3><p id="PN102CA">When a certificate contains alternative names, all common names are ignored.
                    Newer certificates produced by CAs may not even include any common names. For
                    that reason, include all desired hostnames on the alternative names list.</p></div><p id="PN102CC">First, place the extension information in a separate text file. I’m going to call
                it <code class="filename">fd.ext</code>. In the file, specify the name of the extension
                    (<code class="literal">subjectAltName</code>) and list the desired hostnames, as in the
                following example:</p><pre class="programlisting" id="N102D4">subjectAltName = DNS:*.feistyduck.com, DNS:feistyduck.com</pre><p id="PN102D6">Then, when using the <code class="literal">x509</code> command to issue a certificate, refer
                to the file using the <code class="literal">-﻿extfile</code> switch:</p><pre class="programlisting" id="N102DE">$ openssl x509 -req -days 365 \
-in fd.csr -signkey fd.key -out fd.crt \
<strong>-extfile fd.ext</strong></pre><p id="PN102E3">The rest of the process is no different from before. But when you examine the
                generated certificate afterward, you’ll find that it contains the SAN
                extension:</p><pre class="programlisting" id="N102E5"> X509v3 extensions:
            X509v3 Subject Alternative Name:
                DNS:*.feistyduck.com, DNS:feistyduck.com</pre></div><div class="section" title="Examining Certificates"><div class="titlepage"><div><div><h3 class="title"><a id="examining-certificates"/><a class="heading-link" href="ch-openssl.html#examining-certificates">Examining Certificates</a></h3></div></div></div><p id="PN102EB">Certificates might look a lot like random data at first glance, but they contain a
                great deal of information; you just need to know how to unpack it. The
                    <code class="command">x509</code> command does just that, so use it to look at the
                self-signed certificates you generated.</p><p id="PN102F0">In the following example, I use the <code class="literal">-text</code> switch to print
                certificate contents and <code class="literal">-noout</code> to reduce clutter by not printing
                the encoded certificate itself (which is the default behavior):</p><pre class="programlisting" id="N102F8">$ openssl x509 -text -in fd.crt -noout
Certificate:
    Data:
        Version: 1 (0x0)
        Serial Number: 13073330765974645413 (0xb56dcd10f11aaaa5)
    Signature Algorithm: sha1WithRSAEncryption
        Issuer: CN=www.feistyduck.com/emailAddress=webmaster@feistyduck.com, O=Feisty ↩
Duck Ltd, L=London, C=GB
        Validity
            Not Before: Jun  4 17:57:34 2012 GMT
            Not After : Jun  4 17:57:34 2013 GMT
        Subject: CN=www.feistyduck.com/emailAddress=webmaster@feistyduck.com, O=Feisty ↩
Duck Ltd, L=London, C=GB
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b7:fc:ca:1c:a6:c8:56:bb:a3:26:d1:df:e4:e3:
                    [16 more lines...]
                    d1:57
                Exponent: 65537 (0x10001)
    Signature Algorithm: sha1WithRSAEncryption
         49:70:70:41:6a:03:0f:88:1a:14:69:24:03:6a:49:10:83:20:
         [13 more lines...]
         74:a1:11:86</pre><p id="PN102FA">Self-signed certificates usually contain only the most basic certificate data, as
                seen in the previous example. By comparison, certificates issued by public CAs are
                much more interesting, as they contain a number of additional fields (via the X.509
                extension mechanism). Let’s go over them quickly.</p><p id="PN102FC">The <em class="firstterm">Basic Constraints</em> extension is used to mark
                certificates as belonging to a CA, giving them the ability to sign other
                certificates. Non-CA certificates will either have this extension omitted or will
                have the value of CA set to <code class="literal">FALSE</code>. This extension is critical,
                which means that all software-consuming certificates must understand its
                meaning.</p><pre class="programlisting" id="N10304">X509v3 Basic Constraints: critical
    CA:FALSE</pre><p id="PN10306">The <em class="firstterm">Key Usage</em> (KU) and <em class="firstterm">Extended Key
                    Usage</em> (EKU) extensions restrict what a certificate can be used for.
                If these extensions are present, then only the listed uses are allowed. If the
                extensions are not present, there are no use restrictions. What you see in this
                example is typical for a web server certificate, which, for example, does not allow
                for code signing:</p><pre class="programlisting" id="N1030E">X509v3 Key Usage: critical
    Digital Signature, Key Encipherment
X509v3 Extended Key Usage:
    TLS Web Server Authentication, TLS Web Client Authentication</pre><p id="PN10310">The <em class="firstterm">CRL Distribution Points</em> extension lists the addresses
                where the CA’s <em class="firstterm">Certificate Revocation List</em> (CRL)
                information can be found. This information is important in cases in which
                certificates need to be revoked. CRLs are CA-signed lists of revoked certificates,
                published at regular time intervals (e.g., seven days).</p><pre class="programlisting" id="N10318">X509v3 CRL Distribution Points:
    Full Name:
      URI:http://crl.starfieldtech.com/sfs3-20.crl</pre><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN1031B">You might have noticed that the CRL location doesn’t use a secure server, and
                    you might be wondering if the link is thus insecure. It is not. Because each CRL
                    is signed by the CA that issued it, browsers are able to verify its integrity.
                    In fact, if CRLs were distributed over TLS, browsers might face a
                    chicken-and-egg problem in which they want to verify the revocation status of
                    the certificate used by the server delivering the CRL itself!</p></div><p id="PN1031D">The <em class="firstterm">Certificate Policies</em> extension is used to indicate the
                policy under which the certificate was issued. For example, this is where
                    <em class="firstterm">extended validation</em> (EV) indicators can be found (as in
                the example that follows). The indicators are in the form of unique object
                identifiers (OIDs), and they are unique to the issuing CA. In addition, this
                extension often contains one or more <em class="firstterm">Certificate Policy
                    Statement</em> (CPS) points, which are usually web pages or PDF
                documents.</p><pre class="programlisting" id="N10328">X509v3 Certificate Policies:
    Policy: 2.16.840.1.114414.1.7.23.3
    CPS: http://certificates.starfieldtech.com/repository/</pre><p id="PN1032A">The <em class="firstterm">Authority Information Access</em> (AIA) extension usually
                contains two important pieces of information. First, it lists the address of the
                CA’s <em class="firstterm">Online Certificate Status Protocol</em> (OCSP)
                responder, which can be used to check for certificate revocation in real time. The
                extension may also contain a link to where the issuer’s certificate (the next
                certificate in the chain) can be found. These days, server certificates are rarely
                signed directly by trusted root certificates, which means that users must include
                one or more intermediate certificates in their configuration. Mistakes are easy to
                make and will invalidate the certificates. Some clients (e.g., Internet Explorer)
                will use the information provided in this extension to fix an incomplete certificate
                chain, but many clients won’t.</p><pre class="programlisting" id="N10332">Authority Information Access:
    OCSP - URI:http://ocsp.starfieldtech.com/
    CA Issuers - URI:http://certificates.starfieldtech.com/repository/sf↩
_intermediate.crt</pre><p id="PN10334">The <em class="firstterm">Subject Key Identifier</em> and <em class="firstterm">Authority Key
                    Identifier</em> extensions establish unique subject and authority key
                identifiers, respectively. The value specified in the Authority Key Identifier
                extension of a certificate must match the value specified in the Subject Key
                Identifier extension in the issuing certificate. This information is very useful
                during the certification path-building process, in which a client is trying to find
                all possible paths from a leaf (server) certificate to a trusted root. Certification
                authorities will often use one private key with more than one certificate, and this
                field allows software to reliably identify which certificate can be matched to which
                key. In the real world, many certificate chains supplied by servers are invalid, but
                that fact often goes unnoticed because browsers are able to find alternative trust
                paths.</p><pre class="programlisting" id="N1033C">X509v3 Subject Key Identifier:
    4A:AB:1C:C3:D3:4E:F7:5B:2B:59:71:AA:20:63:D6:C9:40:FB:14:F1
X509v3 Authority Key Identifier:
    keyid:49:4B:52:27:D1:1B:BC:F2:A1:21:6A:62:7B:51:42:7A:8A:D7:D5:56</pre><p id="PN1033E">Finally, the <em class="firstterm">Subject Alternative Name</em> extension is used to
                list all the hostnames for which the certificate is valid. This extension used to be
                optional; if it isn’t present, clients fall back to using the information provided
                in the <em class="firstterm">Common Name</em> (CN), which is part of the
                    <em class="firstterm">Subject</em> field. If the extension is present, then the
                content of the CN field is ignored during validation.</p><pre class="programlisting" id="N10349">X509v3 Subject Alternative Name:
    DNS:www.feistyduck.com, DNS:feistyduck.com</pre></div><div class="section" title="Key and Certificate Conversion"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-key-and-certificate-conversion"/><a class="heading-link" href="ch-openssl.html#openssl-key-and-certificate-conversion">Key and Certificate
                        Conversion<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1034F"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10354"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10359"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1035C"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1035F"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10362"></a><a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10365"></a></a></h3></div></div></div><p id="PN10368">Private keys and certificates can be stored in a variety of formats, which means
                that you’ll often need to convert them from one format to another. The most common
                formats are:</p><div class="variablelist"><dl><dt><span class="term">Binary (DER) certificate</span></dt><dd><p id="PN1036F">Contains an X.509 certificate in its raw form, using DER ASN.1
                            encoding.</p></dd><dt><span class="term">ASCII (PEM) certificate(s)</span></dt><dd><p id="PN10375">Contains a base64-encoded DER certificate, with <code class="literal">-----BEGIN
                                CERTIFICATE-----</code> used as the header and <code class="literal">-----END
                                CERTIFICATE-----</code> as the footer. Usually seen with only one
                            certificate per file, although some programs allow more than one
                            certificate depending on the context. For example, older Apache web
                            server versions require the server certificate to be alone in one file,
                            with all intermediate certificates together in another.</p></dd><dt><span class="term">Binary (DER) key</span></dt><dd><p id="PN10381">Contains a private key in its raw form, using DER ASN.1 encoding.
                            OpenSSL creates keys in its own traditional (SSLeay) format. There’s
                            also an alternative format called PKCS#8 (defined in RFC 5208), but it’s
                            not widely used. OpenSSL can convert to and from PKCS#8 format using the
                                <code class="literal">pkcs8</code> command.</p></dd><dt><span class="term">ASCII (PEM) key</span></dt><dd><p id="PN1038A">Contains a base64-encoded DER key, sometimes with additional metadata
                            (e.g., the algorithm used for password protection).</p></dd><dt><span class="term">PKCS#7 certificate(s)</span></dt><dd><p id="PN10390">A complex format designed for the transport of signed or encrypted
                            data, defined in RFC 2315. It’s usually seen with
                                <code class="literal">.p7b</code> and <code class="literal">.p7c</code> extensions and
                            can include the entire certificate chain as needed. This format is
                            supported by Java’s <code class="literal">keytool</code> utility.</p></dd><dt><span class="term">PKCS#12 (PFX) key and certificate(s)</span></dt><dd><p id="PN1039F">A complex format that can store and protect a server key along with an
                            entire certificate chain. It’s commonly seen with
                                <code class="literal">.p12</code> and <code class="literal">.pfx</code> extensions. This
                            format is commonly used in Microsoft products, but is also used for
                            client certificates. These days, the PFX name is used as a synonym for
                            PKCS#12, even though PFX referred to a different format a long time ago
                            (an early version of PKCS#12). It’s unlikely that you’ll encounter the
                            old version anywhere.</p></dd></dl></div><div class="section" title="PEM and DER Conversion"><div class="titlepage"><div><div><h4 class="title"><a id="pem-and-der-conversion"/><a class="heading-link" href="ch-openssl.html#pem-and-der-conversion">PEM and DER Conversion</a></h4></div></div></div><p id="PN103AB">Certificate conversion between PEM and DER formats is performed with the
                        <code class="literal">x509</code> tool. To convert a certificate from PEM to DER
                    format:</p><pre class="programlisting" id="N103B0">$ openssl x509 -inform PEM -in fd.pem -outform DER -out fd.der</pre><p id="PN103B2">To convert a certificate from DER to PEM format:</p><pre class="programlisting" id="N103B4">$ openssl x509 -inform DER -in fd.der -outform PEM -out fd.pem</pre><p id="PN103B6">The syntax is identical if you need to convert private keys between DER and
                    PEM formats, but different commands are used: <code class="command">rsa</code> for RSA
                    keys, and <code class="command">dsa</code> for DSA keys.</p></div><div class="section" title="PKCS#12 (PFX) Conversion"><div class="titlepage"><div><div><h4 class="title"><a id="pkcs12-conversion"/><a class="heading-link" href="ch-openssl.html#pkcs12-conversion">PKCS#12 (PFX) Conversion</a></h4></div></div></div><p id="PN103C2">One command is all that’s needed to convert the key and certificates in PEM
                    format to PKCS#12. The following example converts a key
                        (<code class="filename">fd.key</code>), certificate (<code class="filename">fd.crt</code>),
                    and intermediate certificates (<code class="filename">fd-chain.crt</code>) into an
                    equivalent single PKCS#12 file:</p><pre class="programlisting" id="N103CD">$ openssl pkcs12 -export \
    -name "My Certificate" \
    -out fd.p12 \
    -inkey fd.key \
    -in fd.crt \
    -certfile fd-chain.crt
Enter Export Password: ****************
Verifying - Enter Export Password: ****************</pre><p id="PN103CF">The reverse conversion isn’t as straightforward. You can use a single command,
                    but in that case you’ll get the entire contents in a single file:</p><pre class="programlisting" id="N103D1">$ openssl pkcs12 -in fd.p12 -out fd.pem -nodes</pre><p id="PN103D3">Now, you must open the file <code class="filename">fd.pem</code> in your favorite
                    editor and manually split it into individual key, certificate, and intermediate
                    certificate files. While you’re doing that, you’ll notice additional content
                    provided before each component. For example:</p><pre class="programlisting" id="N103D8">Bag Attributes
    localKeyID: E3 11 E4 F1 2C ED 11 66 41 1B B8 83 35 D2 DD 07 FC DE 28 76
subject=/1.3.6.1.4.1.311.60.2.1.3=GB/2.5.4.15=Private Organization/serialNumber=06694169↩
/C=GB/ST=London/L=London/O=Feisty Duck Ltd/CN=www.feistyduck.com
issuer=/C=US/ST=Arizona/L=Scottsdale/O=Starfield Technologies, Inc./OU=http:/↩
/certificates.starfieldtech.com/repository/CN=Starfield Secure Certification Authority
-----BEGIN CERTIFICATE-----
MIIF5zCCBM+gAwIBAgIHBG9JXlv9vTANBgkqhkiG9w0BAQUFADCB3DELMAkGA1UE
BhMCVVMxEDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxJTAj
[...]</pre><p id="PN103DA">This additional metadata is very handy to quickly identify the certificates.
                    Obviously, you should ensure that the main certificate file contains the leaf
                    server certificate and not something else. Further, you should also ensure that
                    the intermediate certificates are provided in the correct order, with the
                    issuing certificate following the signed one. If you see a self-signed root
                    certificate, feel free to delete it or store it elsewhere; it shouldn’t go into
                    the chain.</p><div class="warning" title="Warning"><h3 class="title">Warning</h3><p id="PN103DD">The final conversion output shouldn’t contain anything apart from the
                        encoded key and certificates. Although some tools are smart enough to ignore
                        what isn’t needed, other tools are not. Leaving extra data in PEM files
                        might result in problems that are difficult to troubleshoot.</p></div><p id="PN103DF">It’s possible to get OpenSSL to split the components for you, but doing so
                    requires multiple invocations of the <code class="literal">pkcs12</code> command
                    (including typing the bundle password each time):</p><pre class="programlisting" id="N103E4">$ openssl pkcs12 -in fd.p12 -nocerts -out fd.key -nodes
$ openssl pkcs12 -in fd.p12 -nokeys -clcerts -out fd.crt
$ openssl pkcs12 -in fd.p12 -nokeys -cacerts -out fd-chain.crt</pre><p id="PN103E6">This approach won’t save you much work. You must still examine each file to
                    ensure that it contains the correct contents and to remove the metadata.</p></div><div class="section" title="PKCS#7 Conversion"><div class="titlepage"><div><div><h4 class="title"><a id="pksc7-conversion"/><a class="heading-link" href="ch-openssl.html#pksc7-conversion">PKCS#7 Conversion</a></h4></div></div></div><p id="PN103EC">To convert from PEM to PKCS#7, use the <code class="command">crl2pkcs7</code>
                    command:</p><pre class="programlisting" id="N103F1">$ openssl crl2pkcs7 -nocrl -out fd.p7b -certfile fd.crt -certfile fd-chain.crt</pre><p id="PN103F3">To convert from PKCS#7 to PEM, use the <code class="command">pkcs7</code> command with
                    the <code class="literal">-print_certs</code> switch:</p><pre class="programlisting" id="N103FB">openssl pkcs7 -in fd.p7b -print_certs -out fd.pem</pre><p id="PN103FD">Similar to the conversion from PKCS#12, you must now edit the
                        <code class="literal">fd.pem</code> file to clean it up and split it into the desired
                    components.</p></div></div></div><div class="section" title="Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="openssl-configuration"/><a class="heading-link" href="ch-openssl.html#openssl-configuration">Configuration</a></h2></div></div></div><p id="PN10406">In this section, I discuss two topics relevant for TLS deployment. The first is cipher
            suite configuration, in which you specify which of the many suites available in TLS you
            wish to use for communication. This topic is important because virtually every program
            that uses OpenSSL reuses its suite configuration mechanism. That means that once you
            learn how to configure cipher suites for one program, you can reuse the same knowledge
            elsewhere. The second topic is the performance measurement of raw crypto
            operations.</p><div class="section" title="Cipher Suite Selection"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-cipher-suite-selection"/><a class="heading-link" href="ch-openssl.html#openssl-cipher-suite-selection">Cipher Suite Selection<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N1040C"></a></a></h3></div></div></div><p id="PN10411">A common task in TLS server configuration is selecting which cipher suites are
                going to be supported. To communicate securely, TLS needs to decide exactly which
                cryptographic primitives to use to achieve its goals (e.g, confidentiality). This is
                done by selecting a suitable cipher suite, which makes a series of decisions about
                how authentication, key exchange, encryption, and other operations are done.
                Programs that rely on OpenSSL usually adopt the same approach to suite configuration
                as OpenSSL does, simply passing through the configuration options. For example, in
                Apache <code class="command">httpd</code>, the cipher suite configuration may look like
                this:</p><pre class="programlisting" id="N10416">SSLHonorCipherOrder On  
SSLCipherSuite "HIGH:!aNULL:@STRENGTH"</pre><p id="PN10418">The first line controls cipher suite prioritization (and configures
                    <code class="command">httpd</code> to actively select suites). The second line controls
                which suites will be supported.</p><p id="PN1041D">Coming up with a good suite configuration can be pretty time consuming, and there
                are a lot of details to consider. The best approach is to use the OpenSSL
                    <code class="command">ciphers</code> command to determine which suites are enabled with a
                particular configuration string.</p><div class="section" title="Obtaining the List of Supported Suites"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-obtaining-the-list-of-supported-suites"/><a class="heading-link" href="ch-openssl.html#openssl-obtaining-the-list-of-supported-suites">Obtaining the List of Supported Suites</a></h4></div></div></div><p id="PN10426">Before you do anything else, you should determine which suites are supported
                    by your OpenSSL installation. To do this, invoke the <code class="command">ciphers</code>
                    command with the switch <code class="literal">-v</code> and the parameter
                        <code class="literal">ALL:COMPLEMENTOFALL</code> (clearly, <code class="literal">ALL</code> does
                    not actually mean “all”):</p><pre class="programlisting" id="N10434">$ openssl ciphers -v 'ALL:COMPLEMENTOFALL'
ECDHE-RSA-AES256-GCM-SHA384    TLSv1.2 Kx=ECDH Au=RSA   Enc=AESGCM(256) Mac=AEAD
ECDHE-ECDSA-AES256-GCM-SHA384  TLSv1.2 Kx=ECDH Au=ECDSA Enc=AESGCM(256) Mac=AEAD
ECDHE-RSA-AES256-SHA384        TLSv1.2 Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA384
ECDHE-ECDSA-AES256-SHA384      TLSv1.2 Kx=ECDH Au=ECDSA Enc=AES(256)    Mac=SHA384
ECDHE-RSA-AES256-SHA           SSLv3   Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA1
[106 more lines...]</pre><div class="tip" title="Tip"><h3 class="title">Tip</h3><p id="PN10437">If you’re using OpenSSL 1.0.0 or later, you can also use the uppercase
                            <code class="literal">-V</code> switch to request extra-verbose output. In this
                        mode, the output will also contain suite IDs, which are always handy to
                        have. For example, OpenSSL does not always use the RFC names for the suites;
                        in such cases, you must use the IDs to cross-check.</p></div><p id="PN1043C">In my case, there were 111 suites in the output. Each line contains
                    information on one suite and the following information:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p id="PN10440">Suite name</p></li><li class="listitem"><p id="PN10443">Required minimum protocol version</p></li><li class="listitem"><p id="PN10446">Key exchange algorithm</p></li><li class="listitem"><p id="PN10449">Authentication algorithm</p></li><li class="listitem"><p id="PN1044C">Cipher algorithm and strength</p></li><li class="listitem"><p id="PN1044F">MAC (integrity) algorithm</p></li><li class="listitem"><p id="PN10452">Export suite indicator</p></li></ol></div><p id="PN10454">If you change the <code class="literal">ciphers</code> parameter to something other than
                        <code class="literal">ALL:COMPLEMENTOFALL</code>, OpenSSL will list only the suites
                    that match that configuration. For example, you can ask it to list only cipher
                    suites that are based on RC4, as follows:</p><pre class="programlisting" id="N1045C">$ openssl ciphers -v 'RC4'
ECDHE-RSA-RC4-SHA    SSLv3 Kx=ECDH       Au=RSA   Enc=RC4(128) Mac=SHA1
ECDHE-ECDSA-RC4-SHA  SSLv3 Kx=ECDH       Au=ECDSA Enc=RC4(128) Mac=SHA1
AECDH-RC4-SHA        SSLv3 Kx=ECDH       Au=None  Enc=RC4(128) Mac=SHA1
ADH-RC4-MD5          SSLv3 Kx=DH         Au=None  Enc=RC4(128) Mac=MD5
ECDH-RSA-RC4-SHA     SSLv3 Kx=ECDH/RSA   Au=ECDH  Enc=RC4(128) Mac=SHA1
ECDH-ECDSA-RC4-SHA   SSLv3 Kx=ECDH/ECDSA Au=ECDH  Enc=RC4(128) Mac=SHA1
RC4-SHA              SSLv3 Kx=RSA        Au=RSA   Enc=RC4(128) Mac=SHA1
RC4-MD5              SSLv3 Kx=RSA        Au=RSA   Enc=RC4(128) Mac=MD5
PSK-RC4-SHA          SSLv3 Kx=PSK        Au=PSK   Enc=RC4(128) Mac=SHA1
EXP-ADH-RC4-MD5      SSLv3 Kx=DH(512)    Au=None  Enc=RC4(40)  Mac=MD5  export
EXP-RC4-MD5          SSLv3 Kx=RSA(512)   Au=RSA   Enc=RC4(40)  Mac=MD5  export</pre><p id="PN1045E">The output will contain all suites that match your requirements, even if
                    they’re insecure. Clearly, you should choose your configuration strings
                    carefully in order to activate only what’s secure. Further, the order in which
                    suites appear in the output matters. When you configure your TLS server to
                    actively select the cipher suite that will be used for a connection (which is
                    the best practice and should always be done), the suites listed first are given
                    priority.</p></div><div class="section" title="Keywords"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-cipher-suite-keywords"/><a class="heading-link" href="ch-openssl.html#openssl-cipher-suite-keywords">Keywords</a></h4></div></div></div><p id="PN10464">Cipher suite <em>keywords</em> are the basic building blocks of
                    cipher suite configuration. Each suite name (e.g., <code class="literal">RC4-SHA</code>)
                    is a keyword that selects exactly one suite. All other keywords select groups of
                    suites according to some criteria. Keyword names are case-sensitive. Normally, I
                    might direct you to the OpenSSL documentation for a comprehensive list of
                    keywords, but it turns out that the ciphers documentation is not up to date;
                    it’s missing some more recent additions. For that reason, I’ll try to document
                    all the keywords in this section.</p><p id="PN1046C">Group keywords are shortcuts that select frequently used cipher suites. For
                    example, <code class="literal">HIGH</code> will select only very strong cipher
                    suites.</p><div class="table"><a id="N10471"/><p class="title"><strong>Table 1.1. Group keywords</strong></p><div class="table-contents"><table summary="Group keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">DEFAULT</code></td><td style="text-align: left">The default cipher list. This is determined at compile time
                                    and, as of OpenSSL 1.0.0, is normally
                                        <code class="literal">ALL:!aNULL:!eNULL</code>. This must be the first
                                    cipher string specified.</td></tr><tr><td style="text-align: left"><code class="literal">COMPLEMENTOFDEFAULT</code></td><td style="text-align: left">The ciphers included in <code class="literal">ALL</code>, but not
                                    enabled by default. Currently, this is <code class="literal">ADH</code>.
                                    Note that this rule does not cover <code class="literal">eNULL</code>,
                                    which is not included by <code class="literal">ALL</code> (use
                                        <code class="literal">COMPLEMENTOFALL</code> if necessary).</td></tr><tr><td style="text-align: left"><code class="literal">ALL</code></td><td style="text-align: left">All cipher suites except the <code class="literal">eNULL</code>
                                    ciphers, which must be explicitly enabled.</td></tr><tr><td style="text-align: left"><code class="literal">COMPLEMENTOFALL</code></td><td style="text-align: left">The cipher suites not enabled by <code class="literal">ALL</code>,
                                    currently <code class="literal">eNULL</code>.</td></tr><tr><td style="text-align: left"><code class="literal">HIGH</code></td><td style="text-align: left">“High”-encryption cipher suites. This currently means those
                                    with key lengths larger than 128 bits, and some cipher suites
                                    with 128-bit keys.</td></tr><tr><td style="text-align: left"><code class="literal">MEDIUM</code></td><td style="text-align: left">“Medium”-encryption cipher suites, currently some of those
                                    using 128-bit encryption.</td></tr><tr><td style="text-align: left"><code class="literal">LOW</code></td><td style="text-align: left">“Low”-encryption cipher suites, currently those using 64- or
                                    56-bit encryption algorithms, but excluding export cipher
                                    suites. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">EXP, EXPORT</code></td><td style="text-align: left">Export encryption algorithms. Including 40- and 56-bit
                                    algorithms. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">EXPORT40</code></td><td style="text-align: left">40-bit export encryption algorithms. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">EXPORT56</code></td><td style="text-align: left">56-bit export encryption algorithms. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">TLSv1, SSLv3, SSLv2</code></td><td style="text-align: left">TLS 1.0, SSL 3, or SSL 2 cipher suites, respectively.</td></tr></tbody></table></div></div><p id="PN104F0">Digest keywords select suites that use a particular digest algorithm. For
                    example, <code class="literal">MD5</code> selects all suites that rely on MD5 for
                    integrity validation.</p><div class="table"><a id="N104F5"/><p class="title"><strong>Table 1.2. Digest algorithm keywords</strong></p><div class="table-contents"><table summary="Digest algorithm keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">MD5</code></td><td style="text-align: left">Cipher suites using MD5. <strong>Obsolete and
                                        insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">SHA</code>, <code class="literal">SHA1</code></td><td style="text-align: left">Cipher suites using SHA1.</td></tr><tr><td style="text-align: left"><code class="literal">SHA256</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using SHA256.</td></tr><tr><td style="text-align: left"><code class="literal">SHA384</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using SHA384.</td></tr></tbody></table></div></div><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN1052C">The digest algorithm keywords select only suites that validate data
                        integrity at the protocol level. TLS 1.2 introduced support for
                        authenticated encryption, which is a mechanism that bundles encryption with
                        integrity validation. When the so-called AEAD (<em class="firstterm">Authenticated
                            Encryption with Associated Data</em>) suites are used, the
                        protocol doesn’t need to provide additional integrity verification. For this
                        reason, you won’t be able to use the digest algorithm keywords to select
                        AEAD suites (currently, those that have GCM in the name). The names of these
                        suites do use <code class="literal">SHA256</code> and <code class="literal">SHA384</code>
                        suffixes, but (confusing as it may be) here they refer to the hash functions
                        used to build the <em class="firstterm">pseudorandom function</em> used with the
                        suite.</p></div><p id="PN1053A">Authentication keywords select suites based on the authentication method they
                    use. Today, virtually all public certificates use RSA for authentication. Over
                    time, we will probably see a very slow rise in the use of Elliptic Curve (ECDSA)
                    certificates.</p><div class="table"><a id="N1053C"/><p class="title"><strong>Table 1.3. Authentication keywords</strong></p><div class="table-contents"><table summary="Authentication keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">aDH</code></td><td style="text-align: left">Cipher suites effectively using DH authentication, i.e., the
                                    certificates carry DH keys. (v1.0.2+)</td></tr><tr><td style="text-align: left"><code class="literal">aDSS</code>, <code class="literal">DSS</code></td><td style="text-align: left">Cipher suites using DSS authentication, i.e., the
                                    certificates carry DSS keys.</td></tr><tr><td style="text-align: left"><code class="literal">aECDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites that use ECDH authentication.</td></tr><tr><td style="text-align: left"><code class="literal">aECDSA</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites that use ECDSA authentication. </td></tr><tr><td style="text-align: left"><code class="literal">aNULL</code></td><td style="text-align: left">Cipher suites offering no authentication. This is currently
                                    the anonymous DH algorithms. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">aRSA</code></td><td style="text-align: left">Cipher suites using RSA authentication, i.e., the
                                    certificates carry RSA keys.</td></tr><tr><td style="text-align: left"><code class="literal">PSK</code></td><td style="text-align: left">Cipher suites using PSK (Pre-Shared Key)
                                    authentication.</td></tr><tr><td style="text-align: left"><code class="literal">SRP</code></td><td style="text-align: left">Cipher suites using SRP (Secure Remote Password)
                                    authentication.</td></tr></tbody></table></div></div><p id="PN1058A">Key exchange keywords select suites based on the key exchange algorithm. When
                    it comes to ephemeral Diffie-Hellman suites, OpenSSL is inconsistent in naming
                    the suites and the keywords. In the suite names, ephemeral suites tend to have
                    an <code class="literal">E</code> at the end of the key exchange algorithm (e.g.,
                        <code class="literal">ECDHE-RSA-RC4-SHA</code> and
                        <code class="literal">DHE-RSA-AES256-SHA</code>), but in the keywords the
                        <code class="literal">E</code> is at the beginning (e.g., <code class="literal">EECDH</code> and
                        <code class="literal">EDH</code>). To make things worse, some older suites do have
                        <code class="literal">E</code> at the beginning of the key exchange algorithm (e.g.,
                        <code class="literal">EDH-RSA-DES-CBC-SHA</code>).</p><div class="table"><a id="N105A4"/><p class="title"><strong>Table 1.4. Key exchange keywords</strong></p><div class="table-contents"><table summary="Key exchange keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">ADH</code></td><td style="text-align: left">Anonymous DH cipher suites. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">AECDH</code> (v1.0.0+)</td><td style="text-align: left">Anonymous ECDH cipher suites. <strong>Insecure.</strong>
                                </td></tr><tr><td style="text-align: left"><code class="literal">DH</code></td><td style="text-align: left">Cipher suites using DH (includes ephemeral and anonymous
                                    DH).</td></tr><tr><td style="text-align: left"><code class="literal">ECDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using ECDH (includes ephemeral and anonymous
                                    ECDH).</td></tr><tr><td style="text-align: left"><code class="literal">EDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using ephemeral DH key agreement.</td></tr><tr><td style="text-align: left"><code class="literal">EECDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using ephemeral ECDH.</td></tr><tr><td style="text-align: left"><code class="literal">kECDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using ECDH key agreement.</td></tr><tr><td style="text-align: left"><code class="literal">kEDH</code></td><td style="text-align: left">Cipher suites using ephemeral DH key agreements (includes
                                    anonymous DH).</td></tr><tr><td style="text-align: left"><code class="literal">kEECDH</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using ephemeral ECDH key agreement (includes
                                    anonymous ECDH).</td></tr><tr><td style="text-align: left"><code class="literal">kRSA</code>, <code class="literal">RSA</code></td><td style="text-align: left">Cipher suites using RSA key exchange.</td></tr></tbody></table></div></div><p id="PN10606">Cipher keywords select suites based on the cipher they use.</p><div class="table"><a id="N10608"/><p class="title"><strong>Table 1.5. Cipher keywords</strong></p><div class="table-contents"><table summary="Cipher keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">3DES</code></td><td style="text-align: left">Cipher suites using triple DES. <strong>Obsolete and insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">AES</code></td><td style="text-align: left">Cipher suites using AES.</td></tr><tr><td style="text-align: left"><code class="literal">AESGCM</code> (v1.0.0+)</td><td style="text-align: left">Cipher suites using AES GCM.</td></tr><tr><td style="text-align: left"><code class="literal">CAMELLIA</code></td><td style="text-align: left">Cipher suites using Camellia. <strong>Obsolete.</strong></td></tr><tr><td style="text-align: left"><code class="literal">DES</code></td><td style="text-align: left">Cipher suites using single DES. <strong>Obsolete and insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">eNULL</code>, <code class="literal">NULL</code></td><td style="text-align: left">Cipher suites that don’t use encryption. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">IDEA</code></td><td style="text-align: left">Cipher suites using IDEA. <strong>Obsolete.</strong></td></tr><tr><td style="text-align: left"><code class="literal">RC2</code></td><td style="text-align: left">Cipher suites using RC2. <strong>Obsolete and
                                        insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">RC4</code></td><td style="text-align: left">Cipher suites using RC4. <strong>Insecure.</strong></td></tr><tr><td style="text-align: left"><code class="literal">SEED</code></td><td style="text-align: left">Cipher suites using SEED. <strong>Obsolete.</strong></td></tr></tbody></table></div></div><p id="PN10676">What remains is a number of suites that do not fit into any other category.
                    The bulk of them are related to the GOST standards, which are relevant for the
                    countries that are part of the Commonwealth of Independent States, formed after
                    the breakup of the Soviet Union.</p><div class="table"><a id="N10678"/><p class="title"><strong>Table 1.6. Miscellaneous keywords</strong></p><div class="table-contents"><table summary="Miscellaneous keywords" border="1"><colgroup><col style="text-align: left" class="c1"/><col style="text-align: left" class="c2"/></colgroup><thead><tr><th style="text-align: left">Keyword</th><th style="text-align: left">Meaning</th></tr></thead><tbody><tr><td style="text-align: left"><code class="literal">@STRENGTH</code></td><td style="text-align: left">Sorts the current cipher suite list in order of encryption
                                    algorithm key length.</td></tr><tr><td style="text-align: left"><code class="literal">aGOST</code></td><td style="text-align: left">Cipher suites using GOST R 34.10 (either 2001 or 94) for
                                    authentication. Requires a GOST-capable engine.</td></tr><tr><td style="text-align: left"><code class="literal">aGOST01</code></td><td style="text-align: left">Cipher suites using GOST R 34.10-2001 authentication.</td></tr><tr><td style="text-align: left"><code class="literal">aGOST94</code></td><td style="text-align: left">Cipher suites using GOST R 34.10-94 authentication. <strong>Obsolete.</strong> Use GOST R 34.10-2001
                                    instead.</td></tr><tr><td style="text-align: left"><code class="literal">kGOST</code></td><td style="text-align: left">Cipher suites using VKO 34.10 key exchange, specified in RFC
                                    4357.</td></tr><tr><td style="text-align: left"><code class="literal">GOST94</code></td><td style="text-align: left">Cipher suites using HMAC based on GOST R 34.11-94.</td></tr><tr><td style="text-align: left"><code class="literal">GOST89MAC</code></td><td style="text-align: left">Cipher suites using GOST 28147-89 MAC instead of
                                    HMAC.</td></tr></tbody></table></div></div></div><div class="section" title="Combining Keywords"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-combining-keywords"/><a class="heading-link" href="ch-openssl.html#openssl-combining-keywords">Combining Keywords</a></h4></div></div></div><p id="PN106C0">In most cases, you’ll use keywords by themselves, but it’s also possible to
                    combine them to select only suites that meet several requirements, by connecting
                    two or more keywords with the <code class="literal">+</code> character. In the following
                    example, we select suites that use RC4 and SHA:</p><pre class="programlisting" id="N106C5">$ openssl ciphers -v 'RC4+SHA'
ECDHE-RSA-RC4-SHA    SSLv3 Kx=ECDH       Au=RSA   Enc=RC4(128) Mac=SHA1
ECDHE-ECDSA-RC4-SHA  SSLv3 Kx=ECDH       Au=ECDSA Enc=RC4(128) Mac=SHA1
AECDH-RC4-SHA        SSLv3 Kx=ECDH       Au=None  Enc=RC4(128) Mac=SHA1
ECDH-RSA-RC4-SHA     SSLv3 Kx=ECDH/RSA   Au=ECDH  Enc=RC4(128) Mac=SHA1
ECDH-ECDSA-RC4-SHA   SSLv3 Kx=ECDH/ECDSA Au=ECDH  Enc=RC4(128) Mac=SHA1
RC4-SHA              SSLv3 Kx=RSA        Au=RSA   Enc=RC4(128) Mac=SHA1
PSK-RC4-SHA          SSLv3 Kx=PSK        Au=PSK   Enc=RC4(128) Mac=SHA1</pre></div><div class="section" title="Building Cipher Suite Lists"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-building-cipher-suite-lists"/><a class="heading-link" href="ch-openssl.html#openssl-building-cipher-suite-lists">Building Cipher Suite Lists</a></h4></div></div></div><p id="PN106CB">The key concept in building a cipher suite configuration is that of the
                        <em>current suite list</em>. The list always starts empty,
                    without any suites, but every keyword that you add to the configuration string
                    will change the list in some way. By default, new suites are appended to the
                    list. For example, to choose all suites that use RC4 and AES ciphers:</p><pre class="programlisting" id="N106D0">$ openssl ciphers -v 'RC4:AES'</pre><p id="PN106D2">The colon character is commonly used to separate keywords, but spaces and
                    commas are equally acceptable. The following command produces the same output as
                    the previous example:</p><pre class="programlisting" id="N106D4">$ openssl ciphers -v 'RC4 AES'</pre></div><div class="section" title="Keyword Modifiers"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-keyword-modifiers"/><a class="heading-link" href="ch-openssl.html#openssl-keyword-modifiers">Keyword Modifiers</a></h4></div></div></div><p id="PN106DA">Keyword modifiers are characters you can place at the beginning of each
                    keyword in order to change the default action (adding to the list) to something
                    else. The following actions are supported:</p><div class="variablelist"><dl><dt><span class="term">Append</span></dt><dd><p id="PN106E1">Add suites to the end of the list. If any of the suites are
                                already on the list, they will remain in their present position.
                                This is the default action, which is invoked when there is no
                                modifier in front of the keyword.</p></dd><dt><span class="term">Delete (<code class="literal">-</code>)</span></dt><dd><p id="PN106EA">Remove all matching suites from the list, potentially allowing
                                some other keyword to reintroduce them later.</p></dd><dt><span class="term">Permanently delete (<code class="literal">!</code>)</span></dt><dd><p id="PN106F3">Remove all matching suites from the list and prevent them from
                                being added later by another keyword. This modifier is useful to
                                specify all the suites you never want to use, making further
                                selection easier and preventing mistakes.</p></dd><dt><span class="term">Move to the end (<code class="literal">+</code>)</span></dt><dd><p id="PN106FC">Move all matching suites to the end of the list. Works only on
                                existing suites; never adds new suites to the list. This modifier is
                                useful if you want to keep some weaker suites enabled but prefer the
                                stronger ones. For example, the string <code class="literal">RC4:+MD5</code>
                                enables all RC4 suites, but pushes the MD5-based ones to the
                                end.</p></dd></dl></div><div class="section" title="Sorting"><div class="titlepage"><div><div><h5 class="title"><a id="openssl-sorting"/><a class="heading-link" href="ch-openssl.html#openssl-sorting">Sorting</a></h5></div></div></div><p id="PN10705">The <code class="literal">@STRENGTH</code> keyword is unlike other keywords (I
                        assume that’s why it has the <code class="literal">@</code> in the name): It will not
                        introduce or remove any suites, but it will sort them in order of descending
                        cipher strength. Automatic sorting is an interesting idea, but it makes
                        sense only in a perfect world in which cipher suites can actually be
                        compared by cipher strength.</p><p id="PN1070D">Take, for example, the following cipher suite configuration:</p><pre class="programlisting" id="N1070F">$ openssl ciphers -v 'DES-CBC-SHA DES-CBC3-SHA RC4-SHA AES256-SHA @STRENGTH'
AES256-SHA                     SSLv3   Kx=RSA  Au=RSA   Enc=AES(256)    Mac=SHA1
DES-CBC3-SHA                   SSLv3   Kx=RSA  Au=RSA   Enc=3DES(168)   Mac=SHA1
RC4-SHA                        SSLv3   Kx=RSA  Au=RSA   Enc=RC4(128)    Mac=SHA1
DES-CBC-SHA                    SSLv3   Kx=RSA  Au=RSA   Enc=DES(56)     Mac=SHA1</pre><p id="PN10711">In theory, the output is sorted in order of strength. In practice, you’ll
                        often want better control of the suite order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p id="PN10715">For example, <code class="literal">AES256-SHA</code> (a CBC suite) is
                                vulnerable to the BEAST attack when used with TLS 1.0 and earlier
                                protocols. If you want to mitigate the BEAST attack server-side,
                                you’ll prefer to prioritize the <code class="literal">RC4-SHA</code> suite,
                                which isn’t vulnerable to this problem.</p></li><li class="listitem"><p id="PN1071E">3DES is only nominally rated at 168 bits; a so-called
                                    <em class="firstterm">meet-in-the-middle</em> attack reduces its
                                strength to 112 bits,<a href="ch-openssl.html#ftn.N10723" id="N10723" class="footnote">9</a> and further issues make the strength as low as 108 bits.<a href="ch-openssl.html#ftn.N1072A" id="N1072A" class="footnote">10</a> This fact makes <code class="literal">DES-CBC3-SHA</code> inferior
                                to 128-bit cipher suites. Strictly speaking, treating 3DES as a
                                168-bit cipher is a bug in OpenSSL that has been fixed in the more
                                recent releases.</p></li></ul></div></div></div><div class="section" title="Handling Errors"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-handling-errors"/><a class="heading-link" href="ch-openssl.html#openssl-handling-errors">Handling Errors</a></h4></div></div></div><p id="PN10738">There are two types of errors you might experience while working on your
                    configuration. The first is a result of a typo or an attempt to use a keyword
                    that does not exist:</p><pre class="programlisting" id="N1073A">$ openssl ciphers -v '@HIGH'
Error in cipher list
140460843755168:error:140E6118:SSL routines:SSL_CIPHER_PROCESS_RULESTR:<strong>invalid ↩
command</strong>:ssl_ciph.c:1317:</pre><p id="PN10740">The output is cryptic, but it does contain an error message.</p><p id="PN10742">Another possibility is that you end up with an empty list of cipher suites, in
                    which case you might see something similar to the following:</p><pre class="programlisting" id="N10744">$ openssl ciphers -v 'SHA512'
Error in cipher list
140202299557536:error:1410D0B9:SSL routines:SSL_CTX_set_cipher_list:<strong>no cipher match</strong>:ssl↩
_lib.c:1312:</pre></div><div class="section" title="Putting It All Together"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-cipher-suites-all-together"/><a class="heading-link" href="ch-openssl.html#openssl-cipher-suites-all-together">Putting It All Together</a></h4></div></div></div><p id="PN1074E">To demonstrate how various cipher suite configuration features come together,
                    I will present one complete real-life use case. Please bear in mind that what
                    follows is just an example. Because there are usually many aspects to consider
                    when deciding on the configuration, there isn’t such a thing as a single perfect
                    configuration.</p><p id="PN10750">For that reason, before you can start to work on your configuration, you
                    should have a clear idea of what you wish to achieve. In my case, I wish to have
                    a reasonably secure and efficient configuration, which I define to mean the
                    following:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p id="PN10754">Use only strong ciphers of 128 effective bits and up (this excludes
                            3DES).</p></li><li class="listitem"><p id="PN10757">Use only suites that provide strong authentication (this excludes
                            anonymous and export suites).</p></li><li class="listitem"><p id="PN1075A">Do not use any suites that rely on weak primitives (e.g., MD5).</p></li><li class="listitem"><p id="PN1075D">Implement robust support for forward secrecy, no matter what keys and
                            protocols are used. With this requirement comes a slight performance
                            penalty, because I won’t be able to use the fast RSA key exchange. I’ll
                            minimize the penalty by prioritizing ECDHE, which is substantially
                            faster than DHE.</p></li><li class="listitem"><p id="PN10760">Prefer ECDSA over RSA. This requirement makes sense only in dual-key
                            deployments, in which we want to use the faster ECDSA operations
                            wherever possible, but fall back to RSA when talking to clients that do
                            not yet support ECDSA.</p></li><li class="listitem"><p id="PN10763">With TLS 1.2 clients, prefer AES GCM suites, which provide the best
                            security TLS can offer.</p></li><li class="listitem"><p id="PN10766">Because RC4 was recently found to be weaker than previously thought,<a href="ch-openssl.html#ftn.N10768" id="N10768" class="footnote">11</a> we want to push it to the end of the list. That’s almost as
                            good as disabling it. Although BEAST might still be a problem in some
                            situations, I’ll assume that it’s been mitigated client-side.</p></li></ol></div><p id="PN1076F">Usually the best approach is to start by permanently eliminating all the
                    components and suites that you don’t wish to use; this reduces clutter and
                    ensures that the undesired suites aren’t introduced back into the configuration
                    by mistake.</p><p id="PN10771">The weak suites can be identified with the following cipher strings:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p id="PN10775"><code class="literal">aNULL</code>; no authentication</p></li><li class="listitem"><p id="PN1077A"><code class="literal">eNULL</code>; no encryption</p></li><li class="listitem"><p id="PN1077F"><code class="literal">LOW</code>; low-strength suites</p></li><li class="listitem"><p id="PN10784"><code class="literal">3DES</code>; effective strength of 108 bits</p></li><li class="listitem"><p id="PN10789"><code class="literal">MD5</code>; suites that use MD5</p></li><li class="listitem"><p id="PN1078E"><code class="literal">EXP</code>; obsolete export suites</p></li></ul></div><p id="PN10792">To reduce the number of suites displayed, I’m going to eliminate all DSA, PSK,
                    SRP, and ECDH suites, because they’re used only very rarely. I am also removing
                    the IDEA and SEED ciphers, which are obsolete but might still be supported by
                    OpenSSL. In my configuration, I won’t use CAMELLIA either, because it’s slower
                    and not as well supported as AES (e.g., no GCM or ECDHE variants in
                    practice).</p><pre class="programlisting" id="N10794">!aNULL !eNULL !LOW !3DES !MD5 !EXP !DSS !PSK !SRP !kECDH !CAMELLIA !IDEA !SEED</pre><p id="PN10796">Now we can focus on what we want to achieve. Because forward secrecy is our
                    priority, we can start with the <code class="literal">kEECDH</code> and
                        <code class="literal">kEDH</code> keywords:</p><pre class="programlisting" id="N1079E">kEECDH kEDH !aNULL !eNULL !LOW !3DES !MD5 !EXP !DSS !PSK !SRP !kECDH !CAMELLIA !IDEA ↩
!SEED</pre><p id="PN107A0">If you test this configuration, you’ll find that RSA suites are listed first,
                    but I said I wanted ECDSA first:</p><pre class="programlisting" id="N107A2">ECDHE-RSA-AES256-GCM-SHA384    TLSv1.2 Kx=ECDH Au=RSA   Enc=AESGCM(256) Mac=AEAD
ECDHE-ECDSA-AES256-GCM-SHA384  TLSv1.2 Kx=ECDH Au=ECDSA Enc=AESGCM(256) Mac=AEAD
ECDHE-RSA-AES256-SHA384        TLSv1.2 Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA384
ECDHE-ECDSA-AES256-SHA384      TLSv1.2 Kx=ECDH Au=ECDSA Enc=AES(256)    Mac=SHA384
ECDHE-RSA-AES256-SHA           SSLv3   Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA1
ECDHE-ECDSA-AES256-SHA         SSLv3   Kx=ECDH Au=ECDSA Enc=AES(256)    Mac=SHA1
ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2 Kx=ECDH Au=RSA   Enc=AESGCM(128) Mac=AEAD
[...]</pre><p id="PN107A4">In order to fix this, I’ll put ECDSA suites first, by placing
                        <code class="literal">kEECDH+ECDSA</code> at the beginning of the
                    configuration:</p><pre class="programlisting" id="N107A9">kEECDH+ECDSA kEECDH kEDH !aNULL !eNULL !LOW !3DES !MD5 !EXP !DSS !PSK !SRP !kECDH ↩
!CAMELLIA !IDEA !SEED</pre><p id="PN107AB">The next problem is that older suites (SSL 3) are mixed with newer suites (TLS
                    1.2). In order to maximize security, I want all TLS 1.2 clients to always
                    negotiate TLS 1.2 suites. To push older suites to the end of the list, I’ll use
                    the <code class="literal">+SHA</code> keyword (TLS 1.2 suites are all using either SHA256
                    or SHA384, so they won’t match):</p><pre class="programlisting" id="N107B0">kEECDH+ECDSA kEECDH kEDH +SHA !aNULL !eNULL !LOW !3DES !MD5 !EXP !DSS !PSK !SRP !kECDH ↩
!CAMELLIA !IDEA !SEED</pre><p id="PN107B2">At this point, I’m mostly done. I only need to add the remaining secure suites
                    to the end of the list; the <code class="literal">HIGH</code> keyword will achieve this.
                    In addition, I’m also going to make sure RC4 suites are last, using
                        <code class="literal">+RC4</code> (to push existing RC4 suites to the end of the list)
                    and <code class="literal">RC4</code> (to add to the list any remaining RC4 suites that are
                    not already on it):</p><pre class="programlisting" id="N107BD">kEECDH+ECDSA kEECDH kEDH HIGH +SHA +RC4 RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !DSS ↩
!PSK !SRP !kECDH !CAMELLIA !IDEA !SEED</pre><p id="PN107BF">Let’s examine the entire final output, which consists of 28 suites. In the
                    first group are the TLS 1.2 suites:</p><pre class="programlisting" id="N107C1">ECDHE-ECDSA-AES256-GCM-SHA384  TLSv1.2 Kx=ECDH Au=ECDSA Enc=AESGCM(256) Mac=AEAD
ECDHE-ECDSA-AES256-SHA384      TLSv1.2 Kx=ECDH Au=ECDSA Enc=AES(256)    Mac=SHA384
ECDHE-ECDSA-AES128-GCM-SHA256  TLSv1.2 Kx=ECDH Au=ECDSA Enc=AESGCM(128) Mac=AEAD
ECDHE-ECDSA-AES128-SHA256      TLSv1.2 Kx=ECDH Au=ECDSA Enc=AES(128)    Mac=SHA256
ECDHE-RSA-AES256-GCM-SHA384    TLSv1.2 Kx=ECDH Au=RSA   Enc=AESGCM(256) Mac=AEAD
ECDHE-RSA-AES256-SHA384        TLSv1.2 Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA384
ECDHE-RSA-AES128-GCM-SHA256    TLSv1.2 Kx=ECDH Au=RSA   Enc=AESGCM(128) Mac=AEAD
ECDHE-RSA-AES128-SHA256        TLSv1.2 Kx=ECDH Au=RSA   Enc=AES(128)    Mac=SHA256
DHE-RSA-AES256-GCM-SHA384      TLSv1.2 Kx=DH   Au=RSA   Enc=AESGCM(256) Mac=AEAD
DHE-RSA-AES256-SHA256          TLSv1.2 Kx=DH   Au=RSA   Enc=AES(256)    Mac=SHA256
DHE-RSA-AES128-GCM-SHA256      TLSv1.2 Kx=DH   Au=RSA   Enc=AESGCM(128) Mac=AEAD
DHE-RSA-AES128-SHA256          TLSv1.2 Kx=DH   Au=RSA   Enc=AES(128)    Mac=SHA256
AES256-GCM-SHA384              TLSv1.2 Kx=RSA  Au=RSA   Enc=AESGCM(256) Mac=AEAD
AES256-SHA256                  TLSv1.2 Kx=RSA  Au=RSA   Enc=AES(256)    Mac=SHA256
AES128-GCM-SHA256              TLSv1.2 Kx=RSA  Au=RSA   Enc=AESGCM(128) Mac=AEAD
AES128-SHA256                  TLSv1.2 Kx=RSA  Au=RSA   Enc=AES(128)    Mac=SHA256</pre><p id="PN107C3">ECDHE suites are first, followed by DHE suites, followed by all other TLS 1.2
                    suites. Within each group, ECDSA and GCM have priority.</p><p id="PN107C5">In the second group are the suites that are going to be used by TLS 1.0
                    clients, using similar priorities as in the first group:</p><pre class="programlisting" id="N107C7">ECDHE-ECDSA-AES256-SHA         SSLv3   Kx=ECDH Au=ECDSA Enc=AES(256)    Mac=SHA1
ECDHE-ECDSA-AES128-SHA         SSLv3   Kx=ECDH Au=ECDSA Enc=AES(128)    Mac=SHA1
ECDHE-RSA-AES256-SHA           SSLv3   Kx=ECDH Au=RSA   Enc=AES(256)    Mac=SHA1
ECDHE-RSA-AES128-SHA           SSLv3   Kx=ECDH Au=RSA   Enc=AES(128)    Mac=SHA1
DHE-RSA-AES256-SHA             SSLv3   Kx=DH   Au=RSA   Enc=AES(256)    Mac=SHA1
DHE-RSA-AES128-SHA             SSLv3   Kx=DH   Au=RSA   Enc=AES(128)    Mac=SHA1
DHE-RSA-SEED-SHA               SSLv3   Kx=DH   Au=RSA   Enc=SEED(128  ) Mac=SHA1
AES256-SHA                     SSLv3   Kx=RSA  Au=RSA   Enc=AES(256)    Mac=SHA1
AES128-SHA                     SSLv3   Kx=RSA  Au=RSA   Enc=AES(128)    Mac=SHA1</pre><p id="PN107C9">Finally, the RC4 suites are at the end:</p><pre class="programlisting" id="N107CB">ECDHE-ECDSA-RC4-SHA            SSLv3   Kx=ECDH Au=ECDSA Enc=RC4(128)    Mac=SHA1
ECDHE-RSA-RC4-SHA              SSLv3   Kx=ECDH Au=RSA   Enc=RC4(128)    Mac=SHA1
RC4-SHA                        SSLv3   Kx=RSA  Au=RSA   Enc=RC4(128)    Mac=SHA1</pre></div><div class="section" title="Recommended Configuration"><div class="titlepage"><div><div><h4 class="title"><a id="openssl-recommended-configuration"/><a class="heading-link" href="ch-openssl.html#openssl-recommended-configuration">Recommended Configuration<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N107D1"></a></a></h4></div></div></div><p id="PN107D6">The configuration in the previous section was designed to use as an example of
                    cipher suite configuration using OpenSSL suite keywords, but it’s not the best
                    setup you could have. In fact, there isn’t any one configuration that will
                    satisfy everyone. In this section, I’ll give you several configurations to
                    choose from based on your preferences and risk assessment.</p><p id="PN107D8">The design principles for all configurations here are essentially the same as
                    those from the previous section, but I am going to make two changes to achieve
                    better performance. First, I am going to put 128-bit suites on top of the list.
                    Although 256-bit suites provide some increase in security, for most sites the
                    increase is not meaningful and yet still comes with the performance penalty.
                    Second, I am going to prefer HMAC-SHA over HMAC-SHA256 and HMAC-SHA384 suites.
                    The latter two are much slower but also don’t provide a meaningful increase in
                    security.</p><p id="PN107DA">In addition, I am going to change my approach from configuring suites using
                    keywords to using suite names directly. I think that keywords, conceptually, are
                    not a bad idea: you specify your security requirements and the library does the
                    rest, without you having to know a lot about the suites that are going to be
                    used. Unfortunately, this approach no longer works well in practice, as we’ve
                    become quite picky about what suites we wish to have enabled and in what
                    order.</p><p id="PN107DC">Using suite names in a configuration is also easier: you just list the suites
                    you want to use. And, when you’re looking at someone’s configuration, you now
                    know exactly what suites are used without having to run the settings through
                    OpenSSL.</p><p id="PN107DE">The following is my default starting configuration, designed to offer strong
                    security as well as good performance:</p><pre class="programlisting" id="N107E0">ECDHE-ECDSA-AES128-GCM-SHA256
ECDHE-ECDSA-AES256-GCM-SHA384
ECDHE-ECDSA-AES128-SHA
ECDHE-ECDSA-AES256-SHA
ECDHE-ECDSA-AES128-SHA256
ECDHE-ECDSA-AES256-SHA384
ECDHE-RSA-AES128-GCM-SHA256
ECDHE-RSA-AES256-GCM-SHA384
ECDHE-RSA-AES128-SHA
ECDHE-RSA-AES256-SHA
ECDHE-RSA-AES128-SHA256
ECDHE-RSA-AES256-SHA384
DHE-RSA-AES128-GCM-SHA256
DHE-RSA-AES256-GCM-SHA384
DHE-RSA-AES128-SHA
DHE-RSA-AES256-SHA
DHE-RSA-AES128-SHA256
DHE-RSA-AES256-SHA256</pre><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN107E3">OpenSSL supports ChaCha20/Poly1305 suites starting with the 1.1.x branch.<a href="ch-openssl.html#ftn.N107E5" id="N107E5" class="footnote">12</a> These authenticated suites (e.g.,
                            <code class="literal">ECDHE-ECDSA-CHACHA20-POLY1305</code> and
                            <code class="literal">ECDHE-RSA-CHACHA20-POLY1305</code>) provide strong security
                        and an alternative to the AES suites. They are said to provide better
                        performance for mobile users, but AES GCM suites are still faster on the
                        modern desktop, where hardware acceleration is available. Place them at the
                        top or just after your GCM suites, depending on how much of your audience
                        uses mobile devices. At the time of writing, OpenSSL doesn’t yet support
                        equal suite preference (like BoringSSL does, for example), which leaves it
                        to the client to choose AES-GCM or ChaCha20 suites.</p></div><p id="PN107F2">This configuration uses only suites that support forward secrecy and provide
                    strong encryption. Most modern browsers and other clients will be able to
                    connect, but some very old clients might not. As an example, older Internet
                    Explorer versions running on Windows XP will fail.</p><p id="PN107F4">If you really need to provide support for a very old range of
                    clients—and only then—consider adding the following suites to the
                    end of the list:</p><pre class="programlisting" id="N107F6">EDH-RSA-DES-CBC3-SHA
AES128-SHA
AES256-SHA
DES-CBC3-SHA
ECDHE-RSA-RC4-SHA
RC4-SHA</pre><p id="PN107F8">Most of these legacy suites use the RSA key exchange, which means that they
                    don’t provide forward secrecy. The AES cipher is preferred, but 3DES and (the
                    insecure) RC4 are also supported for maximum compatibility with as many clients
                    as possible. If the use of RC4 can’t be avoided, the preference is to use the
                    ECDHE suite that provides forward secrecy.</p></div></div><div class="section" title="Performance"><div class="titlepage"><div><div><h3 class="title"><a id="openssl-performance"/><a class="heading-link" href="ch-openssl.html#openssl-performance">Performance<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N107FE"></a></a></h3></div></div></div><p id="PN10803">As you’re probably aware, computation speed is a significant limiting factor for
                any cryptographic operation. OpenSSL comes with a built-in benchmarking tool that
                you can use to get an idea about a system’s capabilities and limits. You can invoke
                the benchmark using the <code class="command">speed</code> command.</p><p id="PN10808">If you invoke <code class="command">speed</code> without any parameters, OpenSSL produces a
                lot of output, little of which will be of interest. A better approach is to test
                only those algorithms that are directly relevant to you. For example, for usage in a
                secure web server, you might care about RC4, AES, RSA, ECDH, and SHA
                algorithms:</p><pre class="programlisting" id="N1080D">$ openssl speed rc4 aes rsa ecdh sha</pre><p id="PN1080F">There are three relevant parts to the output. The first part consists of the
                OpenSSL version number and compile-time configuration. This information is useful if
                you’re testing several different versions of OpenSSL with varying compile-time
                options:</p><pre class="programlisting" id="N10811">OpenSSL 0.9.8k 25 Mar 2009
built on: Wed May 23 00:02:00 UTC 2012
options:bn(64,64) md2(int) rc4(ptr,char) des(idx,cisc,16,int) aes(partial) ↩
blowfish(ptr2)
compiler: cc -fPIC -DOPENSSL_PIC -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN ↩
-DHAVE_DLFCN_H -m64 -DL_ENDIAN -DTERMIO -O3 -Wa,--noexecstack -g -Wall -DMD32_REG_T=int ↩
-DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM
available timing options: TIMES TIMEB HZ=100 [sysconf value]
timing function used: times
The 'numbers' are in 1000s of bytes per second processed.</pre><p id="PN10813">The second part contains symmetric cryptography benchmarks (i.e., hash functions
                and private cryptography):</p><pre class="programlisting" id="N10815">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes
sha1             29275.44k    85281.86k   192290.28k   280526.68k   327553.12k
rc4             160087.81k   172435.03k   174264.75k   176521.50k   176700.62k
aes-128 cbc      90345.06k   140108.84k   170027.92k   179704.12k   182388.44k
aes-192 cbc     104770.95k   134601.12k   148900.05k   152662.30k   153941.11k
aes-256 cbc      95868.62k   116430.41k   124498.19k   127007.85k   127430.81k
sha256           23354.37k    54220.61k    99784.35k   126494.48k   138266.71k
sha512           16022.98k    64657.88k   113304.06k   178301.77k   214539.99k</pre><p id="PN10817">Finally, the third part contains the asymmetric (public) cryptography
                benchmarks:</p><pre class="programlisting" id="N10819">                  sign    verify    sign/s verify/s
rsa  512 bits 0.000120s 0.000011s   8324.9  90730.0
rsa 1024 bits 0.000569s 0.000031s   1757.0  31897.1
rsa 2048 bits 0.003606s 0.000102s    277.3   9762.0
rsa 4096 bits 0.024072s 0.000376s     41.5   2657.4
                              op      op/s
 160 bit ecdh (secp160r1)   0.0003s   2890.2
 192 bit ecdh (nistp192)   0.0006s   1702.9
 224 bit ecdh (nistp224)   0.0006s   1743.5
 256 bit ecdh (nistp256)   0.0007s   1513.3
 384 bit ecdh (nistp384)   0.0015s    689.6
 521 bit ecdh (nistp521)   0.0029s    340.3
 163 bit ecdh (nistk163)   0.0009s   1126.2
 233 bit ecdh (nistk233)   0.0012s    818.5
 283 bit ecdh (nistk283)   0.0028s    360.2
 409 bit ecdh (nistk409)   0.0060s    166.3
 571 bit ecdh (nistk571)   0.0130s     76.8
 163 bit ecdh (nistb163)   0.0009s   1061.3
 233 bit ecdh (nistb233)   0.0013s    755.2
 283 bit ecdh (nistb283)   0.0030s    329.4
 409 bit ecdh (nistb409)   0.0067s    149.7
 571 bit ecdh (nistb571)   0.0146s     68.4</pre><p id="PN1081B">What’s this output useful for? You should be able to compare how compile-time
                options affect speed or how different versions of OpenSSL compare on the same
                platform. For example, the previous results are from a real-life server that’s using
                the OpenSSL 0.9.8k (patched by the distribution vendor). I’m considering moving to
                OpenSSL 1.0.1h because I wish to support TLS 1.1 and TLS 1.2; will there be any
                performance impact? I’ve downloaded and compiled OpenSSL 1.0.1h for a test. Let’s
                see:</p><pre class="programlisting" id="N1081D">$ ./openssl-1.0.1h speed rsa
[...]
OpenSSL 1.0.1h 5 Jun 2014
built on: Thu Jul  3 18:30:06 BST 2014
options:bn(64,64) rc4(8x,int) des(idx,cisc,16,int) aes(partial) idea(int) blowfish(idx)
compiler: gcc -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H ↩
-Wa,--noexecstack -m64 -DL_ENDIAN -DTERMIO -O3 -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN↩
_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512↩
_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM
                  sign    verify    sign/s verify/s
rsa  512 bits 0.000102s 0.000008s   9818.0 133081.7
rsa 1024 bits 0.000326s 0.000020s   3067.2  50086.9
rsa 2048 bits 0.002209s 0.000068s    452.8  14693.6
rsa 4096 bits 0.015748s 0.000255s     63.5   3919.4</pre><p id="PN1081F">Apparently, OpenSSL 1.0.1h is almost twice as fast on this server for my use case
                (2,048-bit RSA key): The performance went from 277 signatures/s to 450 signatures/s.
                This means that I’ll get better performance if I upgrade. Always good news!</p><p id="PN10821">Using the benchmark results to estimate deployment performance is not
                straightforward because of the great number of factors that influence performance in
                real life. Further, many of those factors lie outside TLS (e.g., HTTP keep alive
                settings, caching, etc.). At best, you can use these numbers only for a rough
                estimate.</p><p id="PN10823">But before you can do that, you need to consider something else. By default, the
                    <code class="command">speed</code> command will use only a single process. Most servers
                have multiple cores, so to find out how many TLS operations are supported by the
                entire server, you must instruct <code class="command">speed</code> to use several instances
                in parallel. You can achieve this with the <code class="literal">-multi</code> switch. My
                server has four cores, so that’s what I’m going to use:</p><pre class="programlisting" id="N1082E">$ openssl speed -multi 4 rsa
[...]
OpenSSL 0.9.8k 25 Mar 2009
built on: Wed May 23 00:02:00 UTC 2012
options:bn(64,64) md2(int) rc4(ptr,char) des(idx,cisc,16,int) aes(partial) ↩
blowfish(ptr2)
compiler: cc -fPIC -DOPENSSL_PIC -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN ↩
-DHAVE_DLFCN_H -m64 -DL_ENDIAN -DTERMIO -O3 -Wa,--noexecstack -g -Wall -DMD32_REG_T=int ↩
-DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM
available timing options: TIMES TIMEB HZ=100 [sysconf value]
timing function used:
                  sign    verify    sign/s verify/s
rsa  512 bits 0.000030s 0.000003s  33264.5 363636.4
rsa 1024 bits 0.000143s 0.000008s   6977.9 125000.0
rsa 2048 bits 0.000917s 0.000027s   1090.7  37068.1
rsa 4096 bits 0.006123s 0.000094s    163.3  10652.6</pre><p id="PN10830">As expected, the performance is almost four times better than before. I’m again
                looking at how many RSA signatures can be executed per second, because this is the
                most CPU-intensive cryptographic operation performed on a server and is thus always
                the first bottleneck. The result of 1,090 signatures/second tells us that this
                server can handle about 1,000 brand-new TLS connections per second. In my case,
                that’s sufficient—with a very healthy safety margin. Because I also have session
                resumption enabled on the server, I know that I can support many more than 1,000 TLS
                connections per second. I wish I had enough traffic on that server to worry about
                the performance of TLS.</p><p id="PN10832">Another reason why you shouldn’t believe the output of the
                    <code class="literal">speed</code> command too much is because it doesn’t use the fastest
                available cipher implementations by default. In some ways, the default output is a
                lie. For example, on servers that support the AES-NI instruction set to accelerate
                AES computations, this feature won’t be used by default when testing:</p><pre class="programlisting" id="N10837">$ openssl speed aes-128-cbc
[...]
The 'numbers' are in 1000s of bytes per second processed.
type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes
aes-128 cbc      67546.70k    74183.00k    69278.82k   155942.87k   156486.38k</pre><p id="PN10839">To activate hardware acceleration, you have to use the <code class="literal">-evp</code>
                switch on the command line:</p><pre class="programlisting" id="N1083E">$ openssl speed -evp aes-128-cbc
[...]
The 'numbers' are in 1000s of bytes per second processed.
type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes
aes-128-cbc     188523.36k   223595.37k   229763.58k   203658.58k   206452.14k</pre></div></div><div class="section" title="Creating a Private Certification Authority"><div class="titlepage"><div><div><h2 class="title"><a id="openssl-private-ca"/><a class="heading-link" href="ch-openssl.html#openssl-private-ca">Creating a Private Certification Authority<a xmlns="http://www.w3.org/1999/xhtml" class="indexterm" id="N10844"></a></a></h2></div></div></div><p id="PN10849">If you want to set up your own CA, everything you need is already included in OpenSSL.
            The user interface is purely command line–based and thus not very user friendly, but
            that’s possibly for the better. Going through the process is very educational, because
            it forces you to think about every aspect, even the smallest details.</p><p id="PN1084B">The educational aspect of setting a private CA is the main reason why I would
            recommend doing it, but there are others. An OpenSSL-based CA, crude as it might be, can
            well serve the needs of an individual or a small group. For example, it’s much better to
            use a private CA in a development environment than to use self-signed certificates
            everywhere. Similarly, client certificates—which provide two-factor
            authentication—can significantly increase the security of your sensitive web
            applications.</p><p id="PN1084D">The biggest challenge in running a private CA is not setting everything up but keeping
            the infrastructure secure. For example, the root key must be kept offline because all
            security depends on it. On the other hand, CRLs and OCSP responder certificates must be
            refreshed on a regular basis, which requires bringing the root online.</p><p id="PN1084F">As you go through this section you will create two configuration files: one to control
            the root CA (<code class="filename">root-ca.conf</code>) and another to control the subordinate
            CA (<code class="filename">sub-ca.conf</code>). Although you should be able to do everything from
            scratch just by following my instructions, you can also download the configuration file
            templates from my GitHub account.<a href="ch-openssl.html#ftn.N10857" id="N10857" class="footnote">13</a> The latter option will save you some time, but the former approach will give
            you a better understanding of the work involved.</p><div class="section" title="Features and Limitations"><div class="titlepage"><div><div><h3 class="title"><a id="private-ca-features-and-limitations"/><a class="heading-link" href="ch-openssl.html#private-ca-features-and-limitations">Features and Limitations</a></h3></div></div></div><p id="PN10862">In the rest of this section, we’re going to create a private CA that’s similar in
                structure to public CAs. There’s going to be one root CA from which other
                subordinate CAs can be created. We’ll provide revocation information via CRLs and
                OCSP responders. To keep the root CA offline, OCSP responders are going to have
                their own identities. This isn’t the simplest private CA you could have, but it’s
                one that can be secured properly. As a bonus, the subordinate CA will be
                    <em class="firstterm">technically constrained</em>, which means that it will be
                allowed to issue certificates only for the allowed hostnames.</p><p id="PN10867">After the setup is complete, the root certificate will have to be securely
                distributed to all intended clients. Once the root is in place, you can begin
                issuing client and server certificates. The main limitation of this setup is that
                the OCSP responder is chiefly designed for testing and can be used only for lighter
                loads.</p></div><div class="section" title="Creating a Root CA"><div class="titlepage"><div><div><h3 class="title"><a id="creating-a-root-ca"/><a class="heading-link" href="ch-openssl.html#creating-a-root-ca">Creating a Root CA</a></h3></div></div></div><p id="PN1086D">Creating a new CA involves several steps: configuration, creation of a directory
                structure and initialization of the key files, and finally generation of the root
                key and certificate. This section describes the process as well as the common CA
                operations.</p><div class="section" title="Root CA Configuration"><div class="titlepage"><div><div><h4 class="title"><a id="root-ca-configuration"/><a class="heading-link" href="ch-openssl.html#root-ca-configuration">Root CA Configuration</a></h4></div></div></div><p id="PN10873">Before we can actually create a CA, we need to prepare a configuration file
                        (<code class="filename">root-ca.conf</code>) that will tell OpenSSL exactly how we
                    want things set up. Configuration files aren’t needed most of the time, during
                    normal usage, but they are essential when it comes to complex operations, such
                    as root CA creation. OpenSSL configuration files are powerful; before you
                    proceed I suggest that you familiarize yourself with their capabilities
                        (<code class="command">man config</code> on the command line).</p><p id="PN1087B">The first part of the configuration file contains some basic CA information,
                    such as the name and the base URL, and the components of the CA’s distinguished
                    name. Because the syntax is flexible, information needs to be provided only
                    once:</p><pre class="programlisting" id="N1087D">[default]
name                    = root-ca
domain_suffix           = example.com
aia_url                 = http://$name.$domain_suffix/$name.crt
crl_url                 = http://$name.$domain_suffix/$name.crl
ocsp_url                = http://ocsp.$name.$domain_suffix:9080
default_ca              = ca_default
name_opt                = utf8,esc_ctrl,multiline,lname,align

[ca_dn]
countryName             = "GB"
organizationName        = "Example"
commonName              = "Root CA"</pre><p id="PN1087F">The second part directly controls the CA’s operation. For full information on
                    each setting, consult the documentation for the <code class="command">ca</code> command
                        (<code class="command">man ca</code> on the command line). Most of the settings are
                    self-explanatory; we mostly tell OpenSSL where we want to keep our files.
                    Because this root CA is going to be used only for the issuance of subordinate
                    CAs, I chose to have the certificates valid for 10 years. For the signature
                    algorithm, the secure SHA256 is used by default.</p><p id="PN10887">The default policy (<code class="literal">policy_c_o_match</code>) is configured so that
                    all certificates issued from this CA have the <code class="literal">countryName</code> and
                        <code class="literal">organizationName</code> fields that match that of the CA. This
                    wouldn’t be normally done by a public CA, but it’s appropriate for a private
                    CA:</p><pre class="programlisting" id="N10892">[ca_default]
home                    = .
database                = $home/db/index
serial                  = $home/db/serial
crlnumber               = $home/db/crlnumber
certificate             = $home/$name.crt
private_key             = $home/private/$name.key
RANDFILE                = $home/private/random
new_certs_dir           = $home/certs
unique_subject          = no
copy_extensions         = none
default_days            = 3650
default_crl_days        = 365
default_md              = sha256
policy                  = policy_c_o_match

[policy_c_o_match]
countryName             = match
stateOrProvinceName     = optional
organizationName        = match
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional</pre><p id="PN10894">The third part contains the configuration for the <code class="literal">req</code>
                    command, which is going to be used only once, during the creation of the
                    self-signed root certificate. <a class="indexterm" id="N10899"/>The most important parts are in the extensions: the
                        <code class="literal">basicConstraints</code> extension indicates that the certificate
                    is a CA, and <code class="literal">keyUsage</code> contains the appropriate settings for
                    this scenario:</p><pre class="programlisting" id="N108A3">[req]
default_bits            = 4096
encrypt_key             = yes
default_md              = sha256
utf8                    = yes
string_mask             = utf8only
prompt                  = no
distinguished_name      = ca_dn
req_extensions          = ca_ext

[ca_ext]
basicConstraints        = critical,CA:true
keyUsage                = critical,keyCertSign,cRLSign
subjectKeyIdentifier    = hash</pre><p id="PN108A5">The fourth part of the configuration file contains information that will be
                    used during the construction of certificates issued by the root CA. All
                    certificates will be CAs, as indicated by the
                        <code class="literal">basicConstraints</code> extension, but we set
                        <code class="literal">pathlen</code> to zero, which means that further subordinate CAs
                    are not allowed.</p><p id="PN108AD"><a class="indexterm" id="N108AE"/>All subordinate CAs are going to be constrained, which means that
                    the certificates they issue will be valid only for a subset of domain names and
                    restricted uses. First, the <code class="literal">extendedKeyUsage</code> extension
                    specifies only <code class="literal">clientAuth</code> and <code class="literal">serverAuth</code>,
                    which is TLS client and server authentication. Second, the
                        <code class="literal">nameConstraints</code> extension limits the allowed hostnames
                    only to <code class="uri">example.com</code> and <code class="uri">example.org</code> domain names. In
                    theory, this setup enables you to give control over the subordinate CAs to
                    someone else but still be safe in knowing that they can’t issue certificates for
                    arbitrary hostnames. If you wanted, you could restrict each subordinate CA to a
                    small domain namespace. The requirement to exclude the two IP address ranges
                    comes from the CA/Browser Forum’s Baseline Requirements, which have a definition
                    for technically constrained subordinate CAs.<a href="ch-openssl.html#ftn.N108C4" id="N108C4" class="footnote">14</a></p><p id="PN108CA">In practice, name constraints are not entirely practical, because some major
                    platforms don’t currently recognize the <code class="literal">nameConstraints</code>
                    extension. If you mark this extension as critical, such platforms will reject
                    your certificates. You won’t have such problems if you don’t mark it as critical
                    (as in the example), but then some other platforms won’t enforce it.<a class="indexterm" id="N108CF"/></p><pre class="programlisting" id="N108D2">[sub_ca_ext]
authorityInfoAccess     = @issuer_info
authorityKeyIdentifier  = keyid:always
basicConstraints        = critical,CA:true,pathlen:0
crlDistributionPoints   = @crl_info
extendedKeyUsage        = clientAuth,serverAuth
keyUsage                = critical,keyCertSign,cRLSign
nameConstraints         = @name_constraints
subjectKeyIdentifier    = hash

[crl_info]
URI.0                   = $crl_url

[issuer_info]
caIssuers;URI.0         = $aia_url
OCSP;URI.0              = $ocsp_url

[name_constraints]
permitted;DNS.0=example.com
permitted;DNS.1=example.org
excluded;IP.0=0.0.0.0/0.0.0.0
excluded;IP.1=0:0:0:0:0:0:0:0/0:0:0:0:0:0:0:0</pre><p id="PN108D4">The fifth and final part of the configuration specifies the extensions to be
                    used with the certificate for OCSP response signing. In order to be able to run
                    an OCSP responder, we generate a special certificate and delegate the OCSP
                    signing capability to it. This certificate is not a CA, which you can see from
                    the extensions:</p><pre class="programlisting" id="N108D6">[ocsp_ext]
authorityKeyIdentifier  = keyid:always
basicConstraints        = critical,CA:false
extendedKeyUsage        = OCSPSigning
keyUsage                = critical,digitalSignature
subjectKeyIdentifier    = hash</pre></div><div class="section" title="Root CA Directory Structure"><div class="titlepage"><div><div><h4 class="title"><a id="root-ca-directory-structure"/><a class="heading-link" href="ch-openssl.html#root-ca-directory-structure">Root CA Directory Structure</a></h4></div></div></div><p id="PN108DC">The next step is to create the directory structure specified in the previous
                    section and initialize some of the files that will be used during the CA
                    operation:</p><pre class="programlisting" id="N108DE">$ mkdir root-ca
$ cd root-ca
$ mkdir certs db private
$ chmod 700 private
$ touch db/index
$ openssl rand -hex 16  &gt; db/serial
$ echo 1001 &gt; db/crlnumber</pre><p id="PN108E0">The following subdirectories are used:</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">certs/</code></span></dt><dd><p id="PN108E8">Certificate storage; new certificates will be placed here as they
                                are issued.</p></dd><dt><span class="term"><code class="filename">db/</code></span></dt><dd><p id="PN108EF">This directory is used for the certificate database (index) and
                                the files that hold the next certificate and CRL serial numbers.
                                OpenSSL will create some additional files as needed.</p></dd><dt><span class="term"><code class="filename">private/</code></span></dt><dd><p id="PN108F6">This directory will store the private keys, one for the CA and the
                                other for the OCSP responder. It’s important that no other user has
                                access to it. (In fact, if you’re going to be serious about the CA,
                                the machine on which the root material is stored should have only a
                                minimal number of user accounts.)</p></dd></dl></div><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN108F9">When creating a new CA certificate, it’s important to initialize the
                        certificate serial numbers with a random number generator, as I do in this
                        section. This is very useful if you ever end up creating and deploying
                        multiple CA certificates with the same distinguished name (common if you
                        make a mistake and need to start over); conflicts will be avoided, because
                        the certificates will have different serial numbers.</p></div></div><div class="section" title="Root CA Generation"><div class="titlepage"><div><div><h4 class="title"><a id="root-ca-generation"/><a class="heading-link" href="ch-openssl.html#root-ca-generation">Root CA Generation</a></h4></div></div></div><p id="PN108FF">We take two steps to create the root CA. First, we generate the key and the
                    CSR. All the necessary information will be picked up from the configuration file
                    when we use the <code class="literal">-﻿config</code> switch:</p><pre class="programlisting" id="N10904">$ openssl req -new \
    <strong>-config root-ca.conf</strong> \
    -out root-ca.csr \
    -keyout private/root-ca.key</pre><p id="PN1090A">In the second step, we create a self-signed certificate. The
                        <code class="command">-extensions</code> switch points to the
                        <code class="literal">ca_ext</code> section in the configuration file, which activates
                    the extensions that are appropriate for a root CA:</p><pre class="programlisting" id="N10912">$ openssl ca <strong>-selfsign</strong> \
    -config root-ca.conf \
    -in root-ca.csr \
    -out root-ca.crt \
    <strong>-extensions ca_ext</strong></pre></div><div class="section" title="Structure of the Database File"><div class="titlepage"><div><div><h4 class="title"><a id="private-ca-structure-of-the-database-file"/><a class="heading-link" href="ch-openssl.html#private-ca-structure-of-the-database-file">Structure of the Database File</a></h4></div></div></div><p id="PN1091F">The database in <code class="literal">db/index</code> is a plaintext file that contains
                    certificate information, one certificate per line. Immediately after the root CA
                    creation, it should contain only one line:</p><pre class="programlisting" id="N10924">V    240706115345Z        1001    unknown    /C=GB/O=Example/CN=Root CA</pre><p id="PN10926">Each line contains six values separated by tabs:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p id="PN1092A">Status flag (<code class="literal">V</code> for valid, <code class="literal">R</code> for
                            revoked, <code class="literal">E</code> for expired)</p></li><li class="listitem"><p id="PN10936">Expiration date (in <code class="literal">YYMMDDHHMMSSZ</code> format)</p></li><li class="listitem"><p id="PN1093C">Revocation date or empty if not revoked</p></li><li class="listitem"><p id="PN1093F">Serial number (hexadecimal)</p></li><li class="listitem"><p id="PN10942">File location or <code class="literal">unknown</code> if not known</p></li><li class="listitem"><p id="PN10948">Distinguished name</p></li></ol></div></div><div class="section" title="Root CA Operations"><div class="titlepage"><div><div><h4 class="title"><a id="root-ca-operations"/><a class="heading-link" href="ch-openssl.html#root-ca-operations">Root CA Operations</a></h4></div></div></div><p id="PN1094E">To generate a CRL from the new CA, use the <code class="literal">-gencrl</code> switch
                    of the <code class="command">ca</code> command:</p><pre class="programlisting" id="N10956">$ openssl ca -gencrl \
    -config root-ca.conf \
    -out root-ca.crl</pre><p id="PN10958">To issue a certificate, invoke the <code class="command">ca</code> command with the
                    desired parameters. It’s important that the <code class="literal">-extensions</code>
                    switch points to the correct section in the configuration file (e.g., you don’t
                    want to create another root CA).</p><pre class="programlisting" id="N10960">$ openssl ca \
    -config root-ca.conf \
    -in sub-ca.csr \
    -out sub-ca.crt \
    <strong>-extensions sub_ca_ext</strong></pre><p id="PN10965">To revoke a certificate, use the <code class="literal">-revoke</code> switch of the
                        <code class="literal">ca</code> command; you’ll need to have a copy of the certificate
                    you wish to revoke. Because all certificates are stored in the
                        <code class="filename">certs/</code> directory, you only need to know the serial
                    number. If you have a distinguished name, you can look for the serial number in
                    the database.</p><p id="PN10970">Choose the correct reason for the value in the <code class="literal">-crl_reason</code>
                    switch. The value can be one of the following: <code class="literal">unspecified</code>,
                        <code class="literal">keyCompromise</code>, <code class="literal">CACompromise</code>,
                        <code class="literal">affiliationChanged</code>, <code class="literal">superseded</code>,
                        <code class="literal">cessationOfOperation</code>, <code class="literal">certificateHold,</code>
                    and <code class="literal">removeFromCRL</code>.</p><pre class="programlisting" id="N1098D">$ openssl ca \
    -config root-ca.conf \
    -revoke certs/1002.pem \
    <strong>-crl_reason keyCompromise</strong></pre></div><div class="section" title="Create a Certificate for OCSP Signing"><div class="titlepage"><div><div><h4 class="title"><a id="root-ca-ocsp-signing"/><a class="heading-link" href="ch-openssl.html#root-ca-ocsp-signing">Create a Certificate for OCSP Signing</a></h4></div></div></div><p id="PN10996">First, we create a key and CSR for the OCSP responder. These two operations
                    are done as for any non-CA certificate, which is why we don’t specify a
                    configuration file:</p><pre class="programlisting" id="N10998">$ openssl req -new \
    -newkey rsa:2048 \
    -subj "/C=GB/O=Example/CN=OCSP Root Responder" \
    -keyout private/root-ocsp.key \
    -out root-ocsp.csr</pre><p id="PN1099A">Second, use the root CA to issue a certificate. The value of the
                        <code class="literal">-extensions</code> switch specifies <code class="literal">ocsp_ext</code>,
                    which ensures that extensions appropriate for OCSP signing are set. I reduced
                    the lifetime of the new certificate to 365 days (from the default of 3,650).
                    Because these OCSP certificates don’t contain revocation information, they can’t
                    be revoked. For that reason, you want to keep the lifetime as short as possible.
                    A good choice is 30 days, provided you are prepared to generate a fresh
                    certificate that often:</p><pre class="programlisting" id="N109A2">$ openssl ca \
    -config root-ca.conf \
    -in root-ocsp.csr \
    -out root-ocsp.crt \
    <strong>-extensions ocsp_ext</strong> \
    -days 30</pre><p id="PN109A8">Now you have everything ready to start the OCSP responder. For testing, you
                    can do it from the same machine on which the root CA resides. However, for
                    production you must move the OCSP responder key and certificate
                    elsewhere:</p><pre class="programlisting" id="N109AA">$ openssl ocsp \
    -port 9080
    -index db/index \
    -rsigner root-ocsp.crt \
    -rkey private/root-ocsp.key \
    -CA root-ca.crt \
    -text</pre><p id="PN109AC">You can test the operation of the OCSP responder using the following command
                    line:</p><pre class="programlisting" id="N109AE">$ openssl ocsp \
    -issuer root-ca.crt \
    -CAfile root-ca.crt \
    -cert root-ocsp.crt \
    -url http://127.0.0.1:9080
</pre><p id="PN109B0">In the output, <code class="literal">verify OK</code> means that the signatures were
                    correctly verified, and <code class="literal">good</code> means that the certificate
                    hasn’t been revoked.</p><pre class="programlisting" id="N109B8">Response verify OK
root-ocsp.crt: good
        This Update: Jul  9 18:45:34 2014 GMT</pre></div></div><div class="section" title="Creating a Subordinate CA"><div class="titlepage"><div><div><h3 class="title"><a id="create-a-sub-ca"/><a class="heading-link" href="ch-openssl.html#create-a-sub-ca">Creating a Subordinate CA</a></h3></div></div></div><p id="PN109BE">The process of subordinate CA generation largely mirrors the root CA process. In
                this section, I will only highlight the differences where appropriate. For
                everything else, refer to the previous section.</p><div class="section" title="Subordinate CA Configuration"><div class="titlepage"><div><div><h4 class="title"><a id="sub-ca-configuration"/><a class="heading-link" href="ch-openssl.html#sub-ca-configuration">Subordinate CA Configuration</a></h4></div></div></div><p id="PN109C4">To generate a configuration file (<code class="filename">sub-ca.conf</code>) for the
                    subordinate CA, start with the file we used for the root CA and make the changes
                    listed in this section. We’ll change the name to <code class="literal">sub-ca</code> and
                    use a different distinguished name. We’ll put the OCSP responder on a different
                    port, but only because the <code class="literal">ocsp</code> command doesn’t understand
                    virtual hosts. If you used a proper web server for the OCSP responder, you could
                    avoid using special ports altogether. The default lifetime of new certificates
                    will be 365 days, and we’ll generate a fresh CRL once every 30 days.</p><p id="PN109CF">The change of <code class="literal">copy_extensions</code> to <code class="literal">copy</code>
                    means that extensions from the CSR will be copied into the certificate, but only
                    if they are not already set in our configuration. With this change, whoever is
                    preparing the CSR can put the required alternative names in it, and the
                    information from there will be picked up and placed in the certificate. This
                    feature is somewhat dangerous (you’re allowing someone else to have limited
                    direct control over what goes into a certificate), but I think it’s fine for
                    smaller environments:</p><pre class="programlisting" id="N109D7">[default]
name                    = sub-ca
ocsp_url                = http://ocsp.$name.$domain_suffix:9081

[ca_dn]
countryName             = "GB"
organizationName        = "Example"
commonName              = "Sub CA"

[ca_default]
default_days            = 365
default_crl_days        = 30
copy_extensions         = copy</pre><p id="PN109D9">At the end of the configuration file, we’ll add two new profiles, one each for
                    client and server certificates. The only difference is in the
                        <code class="literal">keyUsage</code> and <code class="literal">extendedKeyUsage</code>
                    extensions. Note that we specify the <code class="literal">basicConstraints</code>
                    extension but set it to <code class="literal">false</code>. We’re doing this because we’re
                    copying extensions from the CSR. If we left this extension out, we might end up
                    using one specified in the CSR:</p><pre class="programlisting" id="N109E7">[server_ext]
authorityInfoAccess     = @issuer_info
authorityKeyIdentifier  = keyid:always
basicConstraints        = critical,CA:false
crlDistributionPoints   = @crl_info
extendedKeyUsage        = clientAuth,serverAuth
keyUsage                = critical,digitalSignature,keyEncipherment
subjectKeyIdentifier    = hash

[client_ext]
authorityInfoAccess     = @issuer_info
authorityKeyIdentifier  = keyid:always
basicConstraints        = critical,CA:false
crlDistributionPoints   = @crl_info
extendedKeyUsage        = clientAuth
keyUsage                = critical,digitalSignature
subjectKeyIdentifier    = hash</pre><p id="PN109E9">After you’re happy with the configuration file, create a directory structure
                    following the same process as for the root CA. Just use a different directory
                    name, for example, <code class="literal">sub-ca</code>.</p></div><div class="section" title="Subordinate CA Generation"><div class="titlepage"><div><div><h4 class="title"><a id="sub-ca-generation"/><a class="heading-link" href="ch-openssl.html#sub-ca-generation">Subordinate CA Generation</a></h4></div></div></div><p id="PN109F2">As before, we take two steps to create the subordinate CA. First, we generate
                    the key and the CSR. All the necessary information will be picked up from the
                    configuration file when we use the <code class="literal">-config</code> switch.</p><pre class="programlisting" id="N109F7">$ openssl req -new \
    <strong>-config sub-ca.conf</strong> \
    -out sub-ca.csr \
    -keyout private/sub-ca.key</pre><p id="PN109FD">In the second step, we get the root CA to issue a certificate. The
                        <code class="command">-extensions</code> switch points to the
                        <code class="literal">sub_ca_ext</code> section in the configuration file, which
                    activates the extensions that are appropriate for the subordinate CA.</p><pre class="programlisting" id="N10A05">$ openssl ca \
    -config root-ca.conf \
    -in sub-ca.csr \
    -out sub-ca.crt \
    <strong>-extensions sub_ca_ext</strong></pre></div><div class="section" title="Subordinate CA Operations"><div class="titlepage"><div><div><h4 class="title"><a id="sub-ca-operations"/><a class="heading-link" href="ch-openssl.html#sub-ca-operations">Subordinate CA Operations</a></h4></div></div></div><p id="PN10A0E">To issue a server certificate, process a CSR while specifying
                        <code class="literal">server_ext</code> in the <code class="literal">-extensions</code>
                    switch:</p><pre class="programlisting" id="N10A16">$ openssl ca \
    -config sub-ca.conf \
    -in server.csr \
    -out server.crt \
    <strong>-extensions server_ext</strong></pre><p id="PN10A1B">To issue a client certificate, process a CSR while specifying
                        <code class="literal">client_ext</code> in the <code class="literal">-extensions</code>
                    switch:</p><pre class="programlisting" id="N10A23">$ openssl ca \
    -config sub-ca.conf \
    -in client.csr \
    -out client.crt \
    <strong>-extensions client_ext</strong></pre><div class="note" title="Note"><h3 class="title">Note</h3><p id="PN10A29">When a new certificate is requested, all its information will be presented
                        to you for verification before the operation is completed. You should always
                        ensure that everything is in order, but especially if you’re working with a
                        CSR that someone else prepared. Pay special attention to the certificate
                        distinguished name and the <code class="literal">basicConstraints</code> and
                            <code class="literal">subjectAlternativeName</code> extensions.</p></div><p id="PN10A31">CRL generation and certificate revocation are the same as for the root CA. The
                    only thing different about the OCSP responder is the port; the subordinate CA
                    should use <code class="literal">9081</code> instead. It’s recommended that the responder
                    uses its own certificate, which avoids keeping the subordinate CA on a public
                    server.</p></div></div><a class="indexterm" id="N10A36"/></div><div id="footnotes"><div class="footnote-line"> </div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N100C4" id="ftn.N100C4" class="para">1</a>] The letters “eay” in the name SSLeay are Eric A. Young’s initials.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N100CD" id="ftn.N100CD" class="para">2</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://www.chromium.org/Home/chromium-security/boringssl">BoringSSL</a> (Chromium, retrieved 30 June 2015)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N100DD" id="ftn.N100DD" class="para">3</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="http://slproweb.com/products/Win32OpenSSL.html">Win32
                        OpenSSL</a> (Shining Light Productions, retrieved 3 July 2014)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N100E4" id="ftn.N100E4" class="para">4</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="http://www.apachelounge.com/download/">Apache 2.4 VC14
                        Binaries and Modules</a> (Apache Lounge, retrieved 15 July 2015)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N100FB" id="ftn.N100FB" class="para">5</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://launchpad.net/ubuntu/precise/+source/openssl">“openssl” source package in Precise</a> (Ubuntu, retrieved 3
                            July 2014)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N10150" id="ftn.N10150" class="para">6</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://outflux.net/blog/archives/2014/02/03/compiler-hardening-in-ubuntu-and-debian/">compiler hardening in Ubuntu and Debian</a> (Kees Cook, 3
                            February 2014)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N101E6" id="ftn.N101E6" class="para">7</a>] A small number of organizations will have very strict security
                                    requirements that require the private keys to be protected at
                                    any cost. For them, the solution is to invest in a
                                        <em>Hardware Security Module</em> (HSM), which
                                    is a type of product specifically designed to make key
                                    extraction impossible, even with physical access to the server.
                                    To make this work, HSMs not only generate and store keys, but
                                    also perform all necessary operations (e.g., signature
                                    generation). HSMs are typically very expensive.</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N10267" id="ftn.N10267" class="para">8</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="http://tools.ietf.org/html/rfc2985">RFC 2985: PKCS
                                #9: Selected Object Classes and Attribute Types Version 2.0</a>
                            (M. Nystrom and B. Kaliski, November 2000)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N10723" id="ftn.N10723" class="para">9</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://en.wikibooks.org/wiki/Cryptography/Meet_In_The_Middle_Attack">Cryptography/Meet In The Middle Attack</a>
                                        (Wikibooks, retrieved 31 March 2014)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N1072A" id="ftn.N1072A" class="para">10</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="http://th.informatik.uni-mannheim.de/people/lucks/publ.shtml">Attacking Triple Encryption</a> (Stefan Lucks,
                                        1998)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N10768" id="ftn.N10768" class="para">11</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="http://www.isg.rhul.ac.uk/tls/">On the
                                        Security of RC4 in TLS and WPA</a> (AlFardan et al., 13
                                    March 2013)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N107E5" id="ftn.N107E5" class="para">12</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://tools.ietf.org/html/rfc7905">RFC 7905:
                                    ChaCha20-Poly1305 Cipher Suites for TLS</a> (Langley et. al,
                                June 2016)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N10857" id="ftn.N10857" class="para">13</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://github.com/ivanr/bulletproof-tls/tree/master/private-ca">OpenSSL CA configuration templates</a> (Bulletproof SSL and TLS GitHub
                    repository, retrieved 31 March 2017)</p></div><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p>[<a href="ch-openssl.html#N108C4" id="ftn.N108C4" class="para">14</a>] <a xmlns="http://www.w3.org/1999/xhtml" class="link" href="https://cabforum.org/baseline-requirements/">Baseline Requirements</a> (The CA/Browser Forum, retrieved 9
                            July 2014)</p></div></div></div><div style="padding-left: 50px; font-family: sans-serif; font-size: 12px; color: #444444; margin-bottom: 15px"><div style="float: left; height: 16px"><a href="https://www.feistyduck.com"><img style="margin-top: 4px; margin-right: 4px; border: 1px solid white" height="15" width="15" src="fd-favicon.png"/></a></div><div style="float: left; height: 16px; padding-top: 6px">Copyright © 2018 <a style="color: #444444" href="https://www.feistyduck.com">Feisty Duck</a>. All rights reserved.</div><div> </div></div><!--FDMARKER:BODY--></body></html>
