<html>

<head>
<meta NAME="GENERATOR" CONTENT="Microsoft FrontPage 3.0">
<title>Mariposa</title>

<meta name="Microsoft Border" content="tb, default"></head>

<body><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>

<table border="0" width="100%">
  <tr>
    <td width="9%"><img src="images/redbookcover.gif" alt="redbookcover.gif (13955 bytes)" WIDTH="72" HEIGHT="93" align="left"></td>
    <td width="91%"><font face="Comic Sans MS"><em>Readings in Database Systems, 3rd Edition</em></font><p><font face="Comic Sans MS">Stonebraker &amp; Hellerstein, eds.</font></td>
  </tr>
</table>

<hr align="center">
</td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top">
<h1>
Mariposa: An Agoric Distributed DBMS for WANs</h1>
Theme: to scale DDBMS to 1000's of sites, need loose coupling.&nbsp; This
can be done with an economic paradigm for resource allocation: query optimization
(scheduling) and data placement.
<p>Bad things about old DDBMSs:
<ul>
<li>
Static data allocation</li>

<li>
Single administrative structure</li>

<li>
Homogeneity of hardware, software, networks</li>
</ul>
Goals of Mariposa:
<ul>
<li>
Scale to 1000's of sites</li>

<li>
Data Mobility</li>

<li>
Local autonomy</li>

<li>
Easily and autonomously configurable policies</li>
</ul>
Mechanism:
<ul>
<li>
Economic (Agoric) paradigm (agora = marketplace)</li>

<li>
Allows point-to-point decision-making to work in a more global context
of resource utilization</li>

<ul>
<li>
removes need for centralized decision-making (e.g. global optimizer)</li>

<li>
in essence, <i>implicit</i> aggregate information (i.e. feedback) is passed
around the network, resulting in rational behavior</li>
</ul>
</ul>
Some important cautionary notes:
<ul>
<li>
Economics is just a useful metaphor for doing decentralized resource allocation.</li>

<li>
This decentralized scheme will not be optimal.&nbsp; Goal is to scale at
the expense of controlling optimality.</li>

<li>
One can spend years arguing about policy, and trying to tune the system
by changing policy.</li>

<li>
Mariposa implemented mechanisms, but did very little research on policy.</li>

<li>
Premature discussions of policy can be VERY distracting -- first put mechanism
in place, THEN play!</li>
</ul>
Architecture and Life of a Query
<ul>
<li>
Data layout: horizontally partitioned table fragments (logical or not),
and replicas (of varying freshness)</li>

<li>
3-tier architecture: clients, middleware, local site manager.&nbsp; Mariposa
requires local sites to run Postgres.</li>

<li>
Query is generated by application, with accompanying "bid curve" ($/Delay).</li>

<li>
Query planning is multi-step, working (more or less) as follows:</li>

<ul>
<li>
<i>optimizer </i>(middleware) runs Selinger as if it were a local single-site
query</li>

<li>
<i>fragmenter</i> (middleware) breaks resulting query plan into pieces,
arranges pieces in trivially parallelizable "strides" (which are NOT pipelined
together, for no apparent reason)</li>

<li>
<i>broker </i>(middleware) sends out Requests For Bid (RFBs) to sites that
might be interested (more on this later)</li>

<li>
<i>bidder </i>(local site) returns a "bid" for a piece of work, consisting
of triple (Cost,Delay,Expiration)</li>

<li>
<i>coordinator</i> (middleware) accepts bids, constructs a final plan,
and informs local sites of their jobs</li>

<li>
<i>coordinator </i>and local <i>executors</i> process the plan</li>
</ul>
</ul>
Details of Bidding
<ul>
<li>
Budget B(t) (bid curve) a non-increasing function of time</li>

<li>
Broker "bids out" single-table subplans or joins of two fragments</li>

<li>
Two protocols: the Long Protocol ("expensive bid") and the Short Protocol
("purchase order")</li>

<ul>
<li>
Long protocol is as described above</li>

<li>
In short protocol, heuristics determine where to send work orders (e.g.
scans at storage sites)</li>
</ul>

<li>
Choosing among bids:</li>

<ul>
<li>
they do this stride-by-stride, but sum of all strides delay must be &lt;=
B(D)</li>

<li>
note that there's parallelism within a stride, so delay for a stride's
bid collection is MAX of delays of the bids in the collection (whereas
cost is SUM of costs)</li>

<li>
ideally, want to pick the "lowest point below the bid curve" -- i.e. maximize
<i>difference
= </i>B(D) - C</li>

<li>
greedy heuristic used in Mariposa:</li>

<ul>
<li>
start with minimal-delay bid collection for each stride.</li>

<li>
for each longer-delay collection, compute <i>cost gradiant:</i> (decrease
in cost)/(increase in time) if we switch to this collection</li>

<li>
swap in maximum cost-gradiant alternative if <i>difference</i> increases.&nbsp;
Recompute cost gradiants.</li>

<li>
repeat until <i>difference</i> will not be improved</li>
</ul>
</ul>

<li>
This is described as a "bottom-up" strategy.&nbsp; An alternative "top-down"
strategy bids out large sub-pieces, which can in turn be busted up by the
bidders and "subcontracted" into separate pieces</li>
</ul>
<b>Discussion</b>: backing off from the details, what is the plan space,
what is "bidding" for, and what about other approaches?
<p>Metadata
<ul>
<li>
How does the broker find sites to get bids?&nbsp; <i>Yellow Pages </i>and
<i>advertisements.</i></li>

<li>
Servers can register services (with prices) at a variety of yellow page
servers.&nbsp; These are timestamped so that freshness can be considered
in bidding.</li>

<li>
Discussion of various costing policy issues: sale prices, coupons, bulk
purchase contracts, etc.</li>

<li>
Don't think any fancy economics got implemented in Mariposa</li>
</ul>
Costing
<ul>
<li>
Simple: charge for CPU cycles and I/O bandwidth, translate to a delay via
site-specific multiplicative factor</li>

<li>
Scale delay or cost by current machine load: gives a simple (though crude)
system-wide feedback for load-balancing.&nbsp; An example of economics
taking the place of a centralized load leveler</li>

<li>
Can set pricing per fragment (why?)</li>

<li>
They talk about network bandwidth reservation, though this was never implemented
(and is not clearly a win in the network world)</li>
</ul>
Storage
<ul>
<li>
Sites can buy and sell fragments; access history required to judge value
of fragments</li>

<li>
To run a subquery, Mariposa requires the site to buy any fragments that
aren't resident; this may require evicting (selling) other fragments.&nbsp;
Note lack of pipelining causing a problem here.</li>

<li>
No discussion here of <i>copies</i>; there was a great deal of thought
about how sites could buy copies and contract for updates at varying rates.&nbsp;
In turn, queries could reason about the age of copies.&nbsp; Since they
built on Postgres, time-travel could allow for consistent (though perhaps
dated) query results regardless of the copies chosen.</li>

<li>
Fragments could get too big or too small, and splitting/coalescing fragments
was seen as an important optimization issue.&nbsp; Either this could be
determined by economics, or by a more direct mechanism.</li>
</ul>
Names &amp; Nameservice
<ul>
<li>
Mariposa used a different naming scheme than R*.</li>

<li>
Really no reason to think it's better than R*'s</li>
</ul>
Status
<ul>
<li>
Mariposa worked well enough for Jeff Sidell to run some TPC-D queries on
half a dozen machines.&nbsp; The simple load-balancing pricing strategy
easily adapted to changing workloads.</li>

<li>
Running queries across the internet resulted in very unpredictable delays.&nbsp;
This undercuts the economic model?&nbsp; See Franklin's "Query Scrambling"
work tomorrow.</li>

<li>
Cohera Corp</li>

<ul>
<li>
Commercializing Mariposa</li>

<li>
Sssshh....wait 'til March 29 (www.cohera.com)</li>
</ul>
</ul>
<b>Discussion II: </b>Why economics?&nbsp; When to use it, when to use
more direct mechanisms?&nbsp; If economics is a metaphor for doing resource
allocation, what are other plausible metaphors/mechanisms that would scale?
&nbsp;<!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><font face="century gothic, arial, helvetica" mstheme>

<p align="center" msthemeseparator><img src="_themes/blueprnt/bluhorsa.gif" width="300" height="10"></p>

<p><strong><font face="Arial"><small><small>© 1999, Joseph M. Hellerstein.&nbsp; Last
modified<small><small> </small></small>03/18/99</small></small></font>.<br>
<font face="Arial"><small><small><a href="feedform.htm">Feedback</a> welcomed.</small></small></font></strong></p>
</font mstheme></td></tr><!--msnavigation--></table></body>
</html>
